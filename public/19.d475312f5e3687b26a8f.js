(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{Ptbo:function(t,e,o){"use strict";o.r(e),o.d(e,"ProyectosModule",function(){return U});var r=o("ofXK"),n=o("tyNb"),i=o("XNiG"),s=o("1G5W"),c=o("nYR2"),a=o("PSD3"),l=o.n(a),d=o("3Pt+"),b=o("ZLyn"),u=o("fXoL"),p=o("T9Ob"),m=o("o1z6"),f=o("FQRV");function h(t,e){if(1&t){const t=u.Qb();u.Pb(0,"app-table",6),u.Wb("onRecargar",function(e){return u.gc(t),u.Yb(2).recargarProyectos(e)})("onCreate",function(){return u.gc(t),u.Yb(2).crearProyecto()})("onEdit",function(e){return u.gc(t),u.Yb(2).editarProyecto(e)})("onDelete",function(e){return u.gc(t),u.Yb(2).borrarProyecto(e)})("onAddPayments",function(e){return u.gc(t),u.Yb(2).addPayment(e)})("onAddAssets",function(e){return u.gc(t),u.Yb(2).addAsset(e)}),u.Ob()}if(2&t){const t=u.Yb(2);u.dc("encabezadosTabla",t.encabezadosTabla)("filasTabla",t.tableData)("totalSection",null==t.projects?null:t.projects.length)("loading",t.loading)("noImage",!0)("addAssets",!0)("addPayments",!0)}}function y(t,e){if(1&t&&(u.Pb(0,"div",2),u.Pb(1,"div",3),u.Pb(2,"div",4),u.kc(3,h,1,7,"app-table",5),u.Ob(),u.Ob(),u.Ob()),2&t){const t=u.Yb();u.zb(3),u.dc("ngIf",t.projects&&t.tableData)}}function g(t,e){if(1&t&&(u.Pb(0,"option",13),u.mc(1),u.Ob()),2&t){const t=e.$implicit;u.dc("value",null==t.Users?null:t.Users.id),u.zb(1),u.oc(" ",(null==t.Users?null:t.Users.first_name)+" "+(null==t.Users?null:t.Users.last_name)+" / email: "+(null==t.Users?null:t.Users.email)," ")}}function v(t,e){1&t&&(u.Pb(0,"span",29),u.mc(1,"Este dato es requerido"),u.Ob())}function P(t,e){1&t&&(u.Pb(0,"label",30),u.mc(1,"T\xedtulo*"),u.Ob())}function O(t,e){1&t&&(u.Pb(0,"span",29),u.mc(1,"Este campo es requerido"),u.Ob())}function F(t,e){1&t&&(u.Pb(0,"span",29),u.mc(1,"Debe tener al menos 6 caracteres"),u.Ob())}function I(t,e){1&t&&(u.Pb(0,"label",31),u.mc(1,"Descripci\xf3n"),u.Ob())}function C(t,e){1&t&&(u.Pb(0,"span",29),u.mc(1,"Debe tener al menos 6 caracteres"),u.Ob())}function j(t,e){1&t&&(u.Pb(0,"label",32),u.mc(1,"Total*"),u.Ob())}function A(t,e){1&t&&(u.Pb(0,"span",29),u.mc(1,"Este campo es requerido"),u.Ob())}function E(t,e){1&t&&(u.Pb(0,"span",29),u.mc(1,"El valor debe ser mayor a 0"),u.Ob())}function T(t,e){1&t&&(u.Pb(0,"label",33),u.mc(1,"Cashflow"),u.Ob())}function w(t,e){1&t&&(u.Pb(0,"span",29),u.mc(1,"Los formatos aceptados son PDF o XLSX"),u.Ob())}function D(t,e){if(1&t){const t=u.Qb();u.Pb(0,"div",2),u.Pb(1,"div",3),u.Pb(2,"div",7),u.Pb(3,"h1",8),u.mc(4),u.Ob(),u.Ob(),u.Pb(5,"div",4),u.Pb(6,"form",9),u.Wb("ngSubmit",function(){return u.gc(t),u.Yb().formSubmit()}),u.Pb(7,"div",4),u.Pb(8,"div",0),u.Pb(9,"div",2),u.Pb(10,"div",10),u.Pb(11,"label",11),u.mc(12,"Usuario*"),u.Ob(),u.Pb(13,"select",12),u.Pb(14,"option",13),u.mc(15,"--Seleccionar un usuario--"),u.Ob(),u.kc(16,g,2,2,"option",14),u.Ob(),u.Pb(17,"div",15),u.kc(18,v,2,0,"span",16),u.Ob(),u.Ob(),u.Pb(19,"div",10),u.kc(20,P,2,0,"label",17),u.Pb(21,"div",18),u.Lb(22,"input",19),u.Pb(23,"div",15),u.kc(24,O,2,0,"span",16),u.kc(25,F,2,0,"span",16),u.Ob(),u.Ob(),u.Ob(),u.Pb(26,"div",10),u.kc(27,I,2,0,"label",20),u.Pb(28,"div",18),u.Lb(29,"textarea",21),u.Pb(30,"div",15),u.kc(31,C,2,0,"span",16),u.Ob(),u.Ob(),u.Ob(),u.Pb(32,"div",10),u.kc(33,j,2,0,"label",22),u.Pb(34,"div",18),u.Lb(35,"input",23),u.Pb(36,"div",15),u.kc(37,A,2,0,"span",16),u.kc(38,E,2,0,"span",16),u.Ob(),u.Ob(),u.Ob(),u.Pb(39,"div",10),u.kc(40,T,2,0,"label",24),u.Pb(41,"div",18),u.Pb(42,"input",25),u.Wb("change",function(e){return u.gc(t),u.Yb().validateCashflowExtension(e)}),u.Ob(),u.Pb(43,"div",15),u.kc(44,w,2,0,"span",16),u.Ob(),u.Ob(),u.Ob(),u.Ob(),u.Ob(),u.Ob(),u.Pb(45,"div",26),u.Pb(46,"button",27),u.mc(47," Confirmar "),u.Ob(),u.Pb(48,"button",28),u.Wb("click",function(){return u.gc(t),u.Yb().recargarProyectos(!0)}),u.mc(49," Volver "),u.Ob(),u.Ob(),u.Ob(),u.Ob(),u.Ob(),u.Ob()}if(2&t){const t=u.Yb();u.zb(4),u.oc("",t.crudAction," Proyecto/s"),u.zb(2),u.dc("formGroup",t.proyectForm),u.zb(8),u.dc("value",null),u.zb(2),u.dc("ngForOf",t.projects),u.zb(2),u.dc("ngIf",(null==t.proyectForm.controls.user.errors?null:t.proyectForm.controls.user.errors.required)&&t.proyectForm.controls.user.touched),u.zb(2),u.dc("ngIf","Editar"===t.crudAction),u.zb(4),u.dc("ngIf",(null==t.proyectForm.controls.title.errors?null:t.proyectForm.controls.title.errors.required)&&t.proyectForm.controls.title.touched),u.zb(1),u.dc("ngIf",(null==t.proyectForm.controls.title.errors?null:t.proyectForm.controls.title.errors.minlength)&&t.proyectForm.controls.title.touched),u.zb(2),u.dc("ngIf","Editar"===t.crudAction),u.zb(4),u.dc("ngIf",(null==t.proyectForm.controls.description.errors?null:t.proyectForm.controls.description.errors.minlength)&&t.proyectForm.controls.description.touched),u.zb(2),u.dc("ngIf","Editar"===t.crudAction),u.zb(4),u.dc("ngIf",(null==t.proyectForm.controls.total.errors?null:t.proyectForm.controls.total.errors.required)&&t.proyectForm.controls.total.touched),u.zb(1),u.dc("ngIf",(null==t.proyectForm.controls.total.errors?null:t.proyectForm.controls.total.errors.min)&&t.proyectForm.controls.total.touched),u.zb(2),u.dc("ngIf","Editar"===t.crudAction),u.zb(4),u.dc("ngIf",!t.acceptedFileTypes)}}const z=[{path:"",component:(()=>{class t{constructor(t,e,o,r,n){this.adminPanelCrudService=t,this.currencyPipe=e,this.fb=o,this.router=r,this.projectService=n,this.someClass=!0,this.projects=[],this.tableData=[],this.encabezadosTabla=["Nombre del proyecto","Anotaciones","Total","Debe","Usuario"],this.loading=!0,this.isCreating=!1,this.isEditing=!1,this.crudAction="",this.fileToUpload=null,this.acceptedFileTypes=!0,this.destroy$=new i.a,this.createForm()}createForm(){this.proyectForm=this.fb.group({title:["",[d.m.required,d.m.minLength(6)]],description:["",[d.m.minLength(6)]],total:[null,[d.m.required,d.m.min(0)]],cashflow:[null],user:[null,d.m.required]})}ngOnInit(){this.getProyects()}formSubmit(){var t,e,o,r;if(this.proyectForm.markAllAsTouched(),this.proyectForm.valid){const n=new FormData;n.append("title",null===(t=this.proyectForm.controls.title)||void 0===t?void 0:t.value),n.append("description",null===(e=this.proyectForm.controls.description)||void 0===e?void 0:e.value),n.append("total",null===(o=this.proyectForm.controls.total)||void 0===o?void 0:o.value),n.append("cashflow",this.fileToUpload),n.append("user",null===(r=this.proyectForm.controls.user)||void 0===r?void 0:r.value),"Crear"===this.crudAction?this.crearProyectoEnLaDb(n):this.editarProyectoEnLaDb(n)}}validateCashflowExtension(t){var e;const o=null===(e=t.target)||void 0===e?void 0:e.files[0];this.acceptedFileTypes="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===o.type||"application/pdf"===o.type,this.fileToUpload=this.acceptedFileTypes?o:null}getProyects(){this.projectService.getAllProjects().pipe(Object(s.a)(this.destroy$),Object(c.a)(()=>this.loading=!1)).subscribe(t=>{var e;(null===(e=null==t?void 0:t.meta)||void 0===e?void 0:e.status.toString().includes("20"))?(this.projects=null==t?void 0:t.data,this.setTableData()):Object(b.d)(t)},t=>Object(b.c)(t))}setTableData(){this.projects.forEach(t=>{var e,o,r,n;return this.tableData.push({imagen:"../../../../../assets/no-image.png",id:t.id,item2:t.title||`Proyecto usuario: ${null===(e=t.Users)||void 0===e?void 0:e.first_name} ${null===(o=t.Users)||void 0===o?void 0:o.last_name}`,item3:t.description||"-",item4:t.total?this.setCurrencyFormat(t.total):"NULL",item6:null!==t.balance||void 0!==t.balance?this.setCurrencyFormat(t.balance):"NULL",item7:`${null===(r=t.Users)||void 0===r?void 0:r.first_name} ${null===(n=t.Users)||void 0===n?void 0:n.last_name}`})})}setCurrencyFormat(t){return this.currencyPipe.transform(t,"$")}recargarProyectos(t){t&&(this.resetsetControls(),this.tableData=[],this.projects=[],this.isCreating=!1,this.isEditing=!1,this.getProyects())}resetsetControls(){var t,e,o,r;null===(t=this.proyectForm.controls.title)||void 0===t||t.setValue(""),null===(e=this.proyectForm.controls.total)||void 0===e||e.setValue(""),null===(o=this.proyectForm.controls.description)||void 0===o||o.setValue(""),null===(r=this.proyectForm.controls.user)||void 0===r||r.setValue("")}crearProyecto(){this.crudAction="Crear",this.isCreating=!0,this.isEditing=!1}crearProyectoEnLaDb(t){this.adminPanelCrudService.create(t,"projects").pipe(Object(s.a)(this.destroy$)).subscribe(t=>{this.recargarProyectos(!0),Object(b.a)(t,"cre\xf3","proyecto")},t=>{this.recargarProyectos(!0),Object(b.c)(t)})}editarProyecto(t){var e;this.crudAction="Editar",this.isEditing=!0,this.isCreating=!1;const o=this.projects.find(e=>e.id===t);o&&(this.projectID=t,this.proyectForm.controls.title.setValue(o.title),this.proyectForm.controls.title.setValue(o.description),this.proyectForm.controls.total.setValue(o.total),this.proyectForm.controls.user.setValue(null===(e=o.Users)||void 0===e?void 0:e.id))}editarProyectoEnLaDb(t){this.adminPanelCrudService.edit(this.projectID,t,"projects").pipe(Object(s.a)(this.destroy$)).subscribe(t=>{this.recargarProyectos(!0),Object(b.a)(t,"edit\xf3","proyecto")},t=>{this.recargarProyectos(!0),Object(b.c)(t)})}borrarProyecto(t){l.a.fire({title:"\xbfSeguro quer\xe9s elimninar el proyecto seleccionado?",showDenyButton:!0,confirmButtonText:"Si, borrar",denyButtonText:"No"}).then(e=>{e.isConfirmed&&this.borrarProyectoEnLaDb(t)})}borrarProyectoEnLaDb(t){this.adminPanelCrudService.delete(t,"projects").pipe(Object(s.a)(this.destroy$)).subscribe(t=>{this.recargarProyectos(!0),Object(b.a)(t,"borr\xf3","proyecto")},t=>Object(b.c)(t))}addPayment(t){this.router.navigateByUrl("/admin/proyectos/payments",{state:{id:t}})}addAsset(t){this.router.navigateByUrl("/admin/proyectos/assets",{state:{id:t}})}alertFailureOrSuccess(t){200===t||201===t?l.a.fire("\xa1Excelente!","El proyecto se elimin\xf3 correctamente","success"):l.a.fire("\xa1Lo sentimos!","No pudimos cargar la informaci\xf3n, por favor recarga la p\xe1gina","error")}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(u.Kb(p.a),u.Kb(r.c),u.Kb(d.c),u.Kb(n.c),u.Kb(m.a))},t.\u0275cmp=u.Eb({type:t,selectors:[["app-proyectos"]],hostVars:2,hostBindings:function(t,e){2&t&&u.Cb("admin-panel-container",e.someClass)},decls:3,vars:2,consts:[[1,"row"],["class","col",4,"ngIf"],[1,"col"],[1,"card"],[1,"card-body"],["title","Proyectos",3,"encabezadosTabla","filasTabla","totalSection","loading","noImage","addAssets","addPayments","onRecargar","onCreate","onEdit","onDelete","onAddPayments","onAddAssets",4,"ngIf"],["title","Proyectos",3,"encabezadosTabla","filasTabla","totalSection","loading","noImage","addAssets","addPayments","onRecargar","onCreate","onEdit","onDelete","onAddPayments","onAddAssets"],[1,"card-header"],[1,"primary-dark"],[1,"form","p-t-20","form-material",3,"formGroup","ngSubmit"],[1,"form-group"],["for","userSelectInput"],["formControlName","user","id","userSelectInput",1,"form-control","custom-select"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"p-2"],["class","text-danger",4,"ngIf"],["for","titleInput",4,"ngIf"],[1,"input-group"],["type","text","placeholder","T\xedtulo","formControlName","title","id","titleInput",1,"form-control"],["for","descriptionTextArea",4,"ngIf"],["id","descriptionTextArea","placeholder","Descripci\xf3n","formControlName","description","cols","30","rows","5",1,"form-control"],["for","totalInput",4,"ngIf"],["type","number","placeholder","Total","formControlName","total","id","totalInput",1,"form-control"],["for","cashFlowInput",4,"ngIf"],["type","file","placeholder","Cashflow","formControlName","cashflow","id","cashFlowInput",1,"form-control",3,"change"],[1,"card-footer"],["type","submit",1,"btn","btn-success","waves-effect","waves-light","m-r-10","bgc-primary-dark"],["type","button",1,"btn","btn-danger","waves-effect","waves-light","m-r-10",3,"click"],[1,"text-danger"],["for","titleInput"],["for","descriptionTextArea"],["for","totalInput"],["for","cashFlowInput"]],template:function(t,e){1&t&&(u.Pb(0,"div",0),u.kc(1,y,4,1,"div",1),u.kc(2,D,50,15,"div",1),u.Ob()),2&t&&(u.zb(1),u.dc("ngIf",!e.isEditing&&!e.isCreating),u.zb(1),u.dc("ngIf",e.isCreating||e.isEditing))},directives:[r.l,f.a,d.n,d.h,d.e,d.l,d.g,d.d,d.i,d.o,r.k,d.b,d.j],styles:[""]}),t})()}];let k=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.Ib({type:t}),t.\u0275inj=u.Hb({imports:[[n.f.forChild(z)],n.f]}),t})();var S=o("6eV/");let U=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.Ib({type:t}),t.\u0275inj=u.Hb({providers:[r.c],imports:[[r.b,k,d.k,S.a]]}),t})()}}]);