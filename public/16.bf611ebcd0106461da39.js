(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{CQpn:function(e,i,t){"use strict";t.r(i),t.d(i,"ServiciosPicturesModule",function(){return k});var r=t("ofXK"),c=t("tyNb"),s=t("XNiG"),a=t("1G5W"),n=t("3Pt+"),o=t("PSD3"),b=t.n(o),d=t("ZLyn"),l=t("AytR"),u=t("fXoL"),g=t("N+K7"),h=t("T9Ob"),p=t("FQRV");const m=["imageInput"];function f(e,i){if(1&e){const e=u.Qb();u.Pb(0,"app-table",6),u.Wb("onRecargar",function(i){return u.gc(e),u.Yb(2).recargarServicePictures(i)})("onCreate",function(){return u.gc(e),u.Yb(2).crearPictures()})("onEdit",function(i){return u.gc(e),u.Yb(2).editarPictures(i)})("onDelete",function(i){return u.gc(e),u.Yb(2).borrarPictures(i)}),u.Ob()}if(2&e){const e=u.Yb(2);u.dc("title","Im\xe1genes de un servicio")("filasTabla",e.tableData)("encabezadosTabla",e.encabezadosTabla)("totalSection",null==e.tableData?null:e.tableData.length)}}function v(e,i){if(1&e&&(u.Pb(0,"div",2),u.Pb(1,"div",3),u.Pb(2,"div",4),u.kc(3,f,1,4,"app-table",5),u.Ob(),u.Ob(),u.Ob()),2&e){const e=u.Yb();u.zb(3),u.dc("ngIf",e.tableData)}}function P(e,i){if(1&e&&(u.Pb(0,"label"),u.mc(1),u.Ob()),2&e){const e=i.$implicit;u.zb(1),u.oc("Categor\xeda de servicio: ",e.title,"")}}function S(e,i){if(1&e){const e=u.Qb();u.Pb(0,"div",19),u.Wb("click",function(){return u.gc(e),u.Yb(2).openInput()}),u.Lb(1,"img",20),u.Ob()}if(2&e){const e=i.$implicit;u.zb(1),u.dc("src",e,u.hc)}}function O(e,i){if(1&e&&(u.Pb(0,"span",25),u.mc(1),u.Ob()),2&e){const e=u.Yb(3);u.zb(1),u.nc(e.creationImageError)}}function y(e,i){1&e&&(u.Pb(0,"span",25),u.mc(1,"Los formatos aceptados son JPG, JPEG y PNG"),u.Ob())}function I(e,i){if(1&e){const e=u.Qb();u.Nb(0),u.Pb(1,"input",21,22),u.Wb("change",function(i){return u.gc(e),u.Yb(2).showSelectedImage(i)}),u.Ob(),u.Pb(3,"div",23),u.kc(4,O,2,1,"span",24),u.kc(5,y,2,0,"span",24),u.Ob(),u.Mb()}if(2&e){const e=u.Yb(2);u.zb(1),u.dc("hidden",!0),u.zb(3),u.dc("ngIf",e.creationImageError),u.zb(1),u.dc("ngIf",!e.acceptedFileTypes)}}function C(e,i){1&e&&(u.Pb(0,"span",25),u.mc(1,"Los formatos aceptados son JPG, JPEG y PNG"),u.Ob())}function T(e,i){if(1&e){const e=u.Qb();u.Pb(0,"input",26,22),u.Wb("change",function(i){return u.gc(e),u.Yb(2).showSelectedImage(i)}),u.Ob(),u.Pb(2,"div",23),u.kc(3,C,2,0,"span",24),u.Ob()}if(2&e){const e=u.Yb(2);u.dc("hidden",!0),u.zb(3),u.dc("ngIf",!e.acceptedFileTypes)}}function E(e,i){if(1&e){const e=u.Qb();u.Pb(0,"div",2),u.Pb(1,"div",3),u.Pb(2,"div",7),u.Pb(3,"h1",8),u.mc(4),u.Ob(),u.Ob(),u.Pb(5,"div",4),u.Pb(6,"form",9),u.Wb("ngSubmit",function(){return u.gc(e),u.Yb().formSubmit()}),u.Pb(7,"div",4),u.Pb(8,"div",10),u.kc(9,P,2,1,"label",11),u.Ob(),u.Pb(10,"div",12),u.kc(11,S,2,1,"div",13),u.kc(12,I,6,3,"ng-container",14),u.kc(13,T,4,2,"ng-template",null,15,u.lc),u.Ob(),u.Ob(),u.Pb(15,"div",16),u.Pb(16,"button",17),u.mc(17," Confirmar "),u.Ob(),u.Pb(18,"button",18),u.Wb("click",function(){return u.gc(e),u.Yb().recargarServicePictures(!0)}),u.mc(19," Volver "),u.Ob(),u.Ob(),u.Ob(),u.Ob(),u.Ob(),u.Ob()}if(2&e){const e=u.fc(14),i=u.Yb();u.zb(4),u.oc("",i.crudAction," Servicios/Im\xe1gen"),u.zb(2),u.dc("formGroup",i.servicePicturesForm),u.zb(3),u.dc("ngForOf",i.categoriaDeServicio),u.zb(2),u.dc("ngForOf",i.imageToShow),u.zb(1),u.dc("ngIf","Crear"===i.crudAction)("ngIfElse",e)}}const w=[{path:"",component:(()=>{class e{constructor(e,i,t,r){this.httpSrv=e,this.adminPanelCrudService=i,this.fb=t,this.activatedRoute=r,this.someClass=!0,this.encabezadosTabla=[],this.tableData=[],this.isCreating=!1,this.isEditing=!1,this.crudAction="",this.categoriaDeServicio=[],this.creationImageError="",this.imageToShow=["../../../../../assets/no-image.png"],this.fileToUpload=[],this.acceptedFileTypes=!0,this.pictureCounter=0,this.pictures=[],this.destroy$=new s.a,this.createForm()}createForm(){this.servicePicturesForm=this.fb.group({serviceId:[null,n.m.required],image:[""]})}showSelectedImage(e){var i,t;if("Crear"!==this.crudAction||this.servicePicturesForm.controls.image.value)if(this.creationImageError="","Crear"===this.crudAction){const t=Array.from(null===(i=e.target)||void 0===i?void 0:i.files);this.checkFilesType(t),t.length&&this.acceptedFileTypes?(this.imageToShow=[],this.fileToUpload=t,this.fileToUpload.forEach(e=>{const i=new FileReader;i.readAsDataURL(e),i.onload=()=>this.imageToShow.push(i.result)})):t.length&&!this.acceptedFileTypes||(this.imageToShow=["../../../../../assets/no-image.png"])}else{const i=null===(t=e.target)||void 0===t?void 0:t.files[0];if(this.acceptedFileTypes="image/jpg"===(null==i?void 0:i.type)||"image/jpeg"===(null==i?void 0:i.type)||"image/png"===(null==i?void 0:i.type),i&&this.acceptedFileTypes){this.fileToUpload=[i];const e=new FileReader;e.readAsDataURL(i),e.onload=()=>this.imageToShow=[e.result]}else this.imageToShow=["../../../../../assets/no-image.png"]}else this.creationImageError="La im\xe1gen es obligatoria"}checkFilesType(e){e.forEach(e=>{this.acceptedFileTypes=!!(e.type.includes("image/jpg")||e.type.includes("image/jpeg")||e.type.includes("image/png"))})}openInput(){this.imageInput.nativeElement.click()}ngOnInit(){this.getServicios()}formSubmit(){if("Crear"!==this.crudAction||this.servicePicturesForm.controls.image.value){if(this.creationImageError="",this.servicePicturesForm.markAllAsTouched(),this.servicePicturesForm.valid){let e={serviceId:this.servicePicturesForm.controls.serviceId.value,pictures:this.fileToUpload};"Crear"===this.crudAction?this.crearPicturesEnLaDb(e):this.editarPicturesEnLaDb(e)}}else this.creationImageError="La im\xe1gen es obligatoria"}getServicios(){this.httpSrv.getAllServices().pipe(Object(a.a)(this.destroy$)).subscribe(e=>{for(const i of e.data)this.categoriaDeServicio.push(i),this.httpSrv.getOneService(i.id.toString()).pipe(Object(a.a)(this.destroy$)).subscribe(i=>{i.meta.status.toString().includes("20")?this.setTableData(i,e.data.length):Object(d.e)(i)},e=>Object(d.d)(e))})}setTableData(e,i){this.activatedRoute.params.pipe(Object(a.a)(this.destroy$)).subscribe({next:t=>{var r,c,s;this.pictureCounter++,this.categoriaDeServicio=this.categoriaDeServicio.filter(e=>e.id===+t.servicioId),null===(r=this.servicePicturesForm.controls.serviceId)||void 0===r||r.setValue(this.categoriaDeServicio[0].id),this.pictures.length||(this.pictures=null===(c=null==e?void 0:e.data)||void 0===c?void 0:c.Pictures.filter(e=>e.services_b_id===+t.servicioId)),this.pictureCounter===i&&(null===(s=this.pictures)||void 0===s||s.forEach(e=>{this.tableData.push({imagen:`${l.a.API_IMAGE_URL}/${e.picture}`,id:e.id})}))},error:e=>Object(d.d)(e)})}recargarServicePictures(e){e&&(this.resetsetControls(),this.tableData=[],this.pictureCounter=0,this.categoriaDeServicio=[],this.pictures=[],this.isCreating=!1,this.isEditing=!1,this.getServicios())}resetsetControls(){this.servicePicturesForm.controls.image.setValue(""),this.imageToShow=["../../../../../assets/no-image.png"],this.fileToUpload=[]}crearPictures(){this.crudAction="Crear",this.isCreating=!0,this.isEditing=!1}crearPicturesEnLaDb(e){this.adminPanelCrudService.createContentOrPictureInService(e,"pictures").pipe(Object(a.a)(this.destroy$)).subscribe(e=>{this.recargarServicePictures(!0),Object(d.a)(e,"cre\xf3","imagen de servicio")},e=>{this.recargarServicePictures(!0),Object(d.d)(e)})}editarPictures(e){var i;this.crudAction="Editar",this.isEditing=!0,this.isCreating=!1;const t=null===(i=this.pictures)||void 0===i?void 0:i.find(i=>i.id===e);t&&(this.pictureId=t.id,this.imageToShow=[`${l.a.API_IMAGE_URL}/${t.picture}`])}editarPicturesEnLaDb(e){this.adminPanelCrudService.editContentOrPictureInService(this.pictureId,e,"pictures").pipe(Object(a.a)(this.destroy$)).subscribe(e=>{this.recargarServicePictures(!0),Object(d.a)(e,"edit\xf3","imagen de servicio")},e=>{this.recargarServicePictures(!0),Object(d.d)(e)})}borrarPictures(e){b.a.fire({title:"\xbfSeguro quer\xe9s elimninar el trabajo realizado seleccionado?",showDenyButton:!0,confirmButtonText:"Si, borrar",denyButtonText:"No"}).then(i=>{i.isConfirmed&&this.borrarContenidoEnLaDb(e)})}borrarContenidoEnLaDb(e){this.adminPanelCrudService.deleteContentOrImageFromService(e,"pictures").pipe(Object(a.a)(this.destroy$)).subscribe(e=>{this.recargarServicePictures(!0),Object(d.a)(e,"borr\xf3","imagen de servicio")},e=>Object(d.d)(e))}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return e.\u0275fac=function(i){return new(i||e)(u.Kb(g.a),u.Kb(h.a),u.Kb(n.c),u.Kb(c.a))},e.\u0275cmp=u.Eb({type:e,selectors:[["app-servicios-pictures"]],viewQuery:function(e,i){if(1&e&&u.rc(m,1),2&e){let e;u.ec(e=u.Xb())&&(i.imageInput=e.first)}},hostVars:2,hostBindings:function(e,i){2&e&&u.Cb("admin-panel-container",i.someClass)},decls:3,vars:2,consts:[[1,"row"],["class","col",4,"ngIf"],[1,"col"],[1,"card"],[1,"card-body"],[3,"title","filasTabla","encabezadosTabla","totalSection","onRecargar","onCreate","onEdit","onDelete",4,"ngIf"],[3,"title","filasTabla","encabezadosTabla","totalSection","onRecargar","onCreate","onEdit","onDelete"],[1,"card-header"],[1,"primary-dark"],[1,"form","p-t-20","form-material",3,"formGroup","ngSubmit"],[1,"form-group"],[4,"ngFor","ngForOf"],[1,"row","justify-content-center"],["class","col-md-4 mb-2",3,"click",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["isEditingTemplate",""],[1,"card-footer"],["type","submit",1,"btn","btn-success","waves-effect","waves-light","m-r-10","bgc-primary-dark"],["type","button",1,"btn","btn-danger","waves-effect","waves-light","m-r-10",3,"click"],[1,"col-md-4","mb-2",3,"click"],["alt","Servicio realizado",1,"img-responsive","image-gallery",3,"src"],["type","file","formControlName","image","multiple","",3,"hidden","change"],["imageInput",""],[1,"p-2","text-center"],["class","text-danger",4,"ngIf"],[1,"text-danger"],["type","file","formControlName","image",3,"hidden","change"]],template:function(e,i){1&e&&(u.Pb(0,"div",0),u.kc(1,v,4,1,"div",1),u.kc(2,E,20,6,"div",1),u.Ob()),2&e&&(u.zb(1),u.dc("ngIf",!i.isEditing&&!i.isCreating),u.zb(1),u.dc("ngIf",i.isCreating||i.isEditing))},directives:[r.m,p.a,n.n,n.h,n.e,r.l,n.b,n.g,n.d],styles:[".image-gallery[_ngcontent-%COMP%]{height:100%}"]}),e})()}];let F=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=u.Ib({type:e}),e.\u0275inj=u.Hb({imports:[[c.f.forChild(w)],c.f]}),e})();var D=t("6eV/");let k=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=u.Ib({type:e}),e.\u0275inj=u.Hb({imports:[[r.c,F,D.a,n.k]]}),e})()}}]);