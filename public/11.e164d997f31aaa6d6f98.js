(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{qJPh:function(t,e,s){"use strict";s.r(e),s.d(e,"ManageProyectAssetsModule",function(){return T});var i=s("ofXK"),a=s("tyNb"),r=s("XNiG"),o=s("1G5W"),n=s("ZLyn"),c=s("AytR"),b=s("PSD3"),d=s.n(b),l=s("fXoL"),h=s("o1z6"),g=s("3Pt+"),u=s("T9Ob"),p=s("FQRV");function m(t,e){if(1&t){const t=l.Qb();l.Pb(0,"app-table",6),l.Wb("onRecargar",function(e){return l.gc(t),l.Yb(2).recargarAssets(e)})("onCreate",function(){return l.gc(t),l.Yb(2).crearAsset()})("onEdit",function(e){return l.gc(t),l.Yb(2).editarAssets(e)})("onDelete",function(e){return l.gc(t),l.Yb(2).borrarAsset(e)}),l.Ob()}if(2&t){const t=l.Yb(2);l.dc("encabezadosTabla",t.encabezadosTabla)("filasTabla",t.tableData)("totalSection",null==t.assets?null:t.assets.length)}}function f(t,e){if(1&t&&(l.Pb(0,"div",2),l.Pb(1,"div",3),l.Pb(2,"div",4),l.kc(3,m,1,3,"app-table",5),l.Ob(),l.Ob(),l.Ob()),2&t){const t=l.Yb();l.zb(3),l.dc("ngIf",t.assets&&t.tableData)}}function v(t,e){if(1&t&&(l.Pb(0,"span",19),l.mc(1),l.Ob()),2&t){const t=l.Yb(2);l.zb(1),l.nc(t.creationImageError)}}function A(t,e){1&t&&(l.Pb(0,"span",19),l.Pb(1,"p"),l.mc(2,"Formatos aceptados para im\xe1gen: JPG, JPEG y PNG"),l.Ob(),l.Pb(3,"P"),l.mc(4,"Formatos aceptados para video: MOV, AVI, MP4, WMV, MKV"),l.Ob(),l.Ob())}function y(t,e){if(1&t){const t=l.Qb();l.Pb(0,"div",2),l.Pb(1,"div",3),l.Pb(2,"div",7),l.Pb(3,"h1",8),l.mc(4),l.Ob(),l.Ob(),l.Pb(5,"div",4),l.Pb(6,"form",9),l.Wb("ngSubmit",function(){return l.gc(t),l.Yb().formSubmit()}),l.Pb(7,"div",4),l.Pb(8,"div",10),l.Wb("click",function(){return l.gc(t),l.fc(11).click()}),l.Lb(9,"img",11),l.Pb(10,"input",12,13),l.Wb("change",function(e){return l.gc(t),l.Yb().showSelectedImage(e)}),l.Ob(),l.Pb(12,"div",14),l.kc(13,v,2,1,"span",15),l.kc(14,A,5,0,"span",15),l.Ob(),l.Ob(),l.Ob(),l.Pb(15,"div",16),l.Pb(16,"button",17),l.mc(17," Confirmar "),l.Ob(),l.Pb(18,"button",18),l.Wb("click",function(){return l.gc(t),l.Yb().recargarAssets(!0)}),l.mc(19," Volver "),l.Ob(),l.Ob(),l.Ob(),l.Ob(),l.Ob(),l.Ob()}if(2&t){const t=l.Yb();l.zb(4),l.oc("",t.crudAction," Galer\xeda"),l.zb(2),l.dc("formGroup",t.assetsForm),l.zb(3),l.dc("src",t.imageToShow,l.hc),l.zb(1),l.dc("hidden",!0),l.zb(3),l.dc("ngIf",t.creationImageError),l.zb(1),l.dc("ngIf",!t.acceptedFileTypes)}}const O=[{path:"",component:(()=>{class t{constructor(t,e,s,i){this.router=t,this.projectsService=e,this.fb=s,this.adminPanelCrudService=i,this.assets=[],this.tableData=[],this.encabezadosTabla=[],this.isCreating=!1,this.isEditing=!1,this.crudAction="",this.imageToShow="../../../../../assets/no-image.png",this.acceptedFileTypes=!0,this.creationImageError="",this.destroy$=new r.a,this.getprojectId(),this.projectID?this.createForm():this.router.navigateByUrl("/admin/proyectos")}getprojectId(){var t,e,s;this.projectID=null===(s=null===(e=null===(t=this.router.getCurrentNavigation())||void 0===t?void 0:t.extras)||void 0===e?void 0:e.state)||void 0===s?void 0:s.id}createForm(){this.assetsForm=this.fb.group({asset:[""]})}showSelectedImage(t){var e,s;if("Crear"===this.crudAction&&!(null===(e=this.assetsForm.controls.asset)||void 0===e?void 0:e.value))return void(this.creationImageError="El archivo es obligatorio");this.creationImageError="";const i=null===(s=t.target)||void 0===s?void 0:s.files[0];if(this.acceptedFileTypes="image/jpg"===i.type||"image/jpeg"===i.type||"image/png"===i.type||"video/mp4"===i.type||"video/avi"===i.type||"video/mov"===i.type||"video/wmv"===i.type||"video/mkv"===i.type,i&&this.acceptedFileTypes)if(this.fileToUpload=i,i.type.includes("image")){const t=new FileReader;t.readAsDataURL(i),t.onload=()=>this.imageToShow=t.result}else this.imageToShow="../../../../../assets/no-image-video.jpg";else this.imageToShow="../../../../../assets/no-image.png",this.fileToUpload=null}formSubmit(){var t;if(this.assetsForm.markAllAsTouched(),null===(t=this.assetsForm.controls.asset)||void 0===t?void 0:t.value){if(this.assetsForm.valid){const t=new FormData;this.fileToUpload&&(t.append("asset",this.fileToUpload),t.append("projects_id",this.projectID.toString()),"Crear"===this.crudAction?this.crearAssetEnLaDb(t):this.editarAssetEnLaDb(t))}}else this.creationImageError="El archivo es obligatorio"}ngOnInit(){this.getAssets()}getAssets(){this.projectsService.getOneProject(this.projectID).pipe(Object(o.a)(this.destroy$)).subscribe(t=>{var e,s;(null===(e=null==t?void 0:t.meta)||void 0===e?void 0:e.status.toString().includes("20"))?(this.project=t.data,this.assets=null===(s=null==t?void 0:t.data)||void 0===s?void 0:s.Assets,this.setTableData()):Object(n.d)(t)},t=>Object(n.c)(t))}setTableData(){this.assets.forEach(t=>this.tableData.push({id:t.id,imagen:`${c.a.API_IMAGE_URL}/${t.asset}`||"../../../../../assets/no-image.png"}))}recargarAssets(t){t&&(this.resetsetControls(),this.tableData=[],this.assets=[],this.isCreating=!1,this.isEditing=!1,this.fileToUpload=null,this.imageToShow="../../../../../assets/no-image.png",this.getAssets())}resetsetControls(){var t;null===(t=this.assetsForm.controls.asset)||void 0===t||t.setValue("")}crearAsset(){this.crudAction="Crear",this.isCreating=!0,this.isEditing=!1}crearAssetEnLaDb(t){this.adminPanelCrudService.create(t,"assets").pipe(Object(o.a)(this.destroy$)).subscribe(t=>{this.recargarAssets(!0),Object(n.a)(t,"cre\xf3","archivo")},t=>{this.recargarAssets(!0),Object(n.c)(t)})}editarAssets(t){this.crudAction="Editar",this.isEditing=!0,this.isCreating=!1,this.assets.find(e=>e.id===t)&&(this.assetId=t)}editarAssetEnLaDb(t){this.adminPanelCrudService.edit(this.assetId,t,"assets").pipe(Object(o.a)(this.destroy$)).subscribe(t=>{this.recargarAssets(!0),Object(n.a)(t,"edit\xf3","archivo")},t=>{this.recargarAssets(!0),Object(n.c)(t)})}borrarAsset(t){d.a.fire({title:"\xbfSeguro quer\xe9s elimninar el archivo seleccionado?",showDenyButton:!0,confirmButtonText:"Si, borrar",denyButtonText:"No"}).then(e=>{e.isConfirmed&&this.borrarAssetEnLaDb(t)})}borrarAssetEnLaDb(t){this.adminPanelCrudService.delete(t,"assets").pipe(Object(o.a)(this.destroy$)).subscribe(t=>{this.recargarAssets(!0),Object(n.a)(t,"borr\xf3","archivo")},t=>{this.recargarAssets(!0),Object(n.c)(t)})}}return t.\u0275fac=function(e){return new(e||t)(l.Kb(a.c),l.Kb(h.a),l.Kb(g.c),l.Kb(u.a))},t.\u0275cmp=l.Eb({type:t,selectors:[["app-manage-proyect-assets"]],decls:3,vars:2,consts:[[1,"row"],["class","col",4,"ngIf"],[1,"col"],[1,"card"],[1,"card-body"],["title","Galer\xeda",3,"encabezadosTabla","filasTabla","totalSection","onRecargar","onCreate","onEdit","onDelete",4,"ngIf"],["title","Galer\xeda",3,"encabezadosTabla","filasTabla","totalSection","onRecargar","onCreate","onEdit","onDelete"],[1,"card-header"],[1,"primary-dark"],[1,"form","p-t-20","form-material",3,"formGroup","ngSubmit"],[1,"col",3,"click"],["alt","Lote",1,"img-responsive",3,"src"],["type","file","formControlName","asset",3,"hidden","change"],["imageInput",""],[1,"p-2"],["class","text-danger",4,"ngIf"],[1,"card-footer"],["type","submit",1,"btn","btn-success","waves-effect","waves-light","m-r-10","bgc-primary-dark"],["type","button",1,"btn","btn-danger","waves-effect","waves-light","m-r-10",3,"click"],[1,"text-danger"]],template:function(t,e){1&t&&(l.Pb(0,"div",0),l.kc(1,f,4,1,"div",1),l.kc(2,y,20,6,"div",1),l.Ob()),2&t&&(l.zb(1),l.dc("ngIf",!e.isEditing&&!e.isCreating),l.zb(1),l.dc("ngIf",e.isCreating||e.isEditing))},directives:[i.m,p.a,g.n,g.h,g.e,g.b,g.g,g.d],styles:[""]}),t})()}];let P=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.Ib({type:t}),t.\u0275inj=l.Hb({imports:[[a.f.forChild(O)],a.f]}),t})();var I=s("6eV/");let T=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.Ib({type:t}),t.\u0275inj=l.Hb({imports:[[i.c,P,g.k,I.a]]}),t})()}}]);