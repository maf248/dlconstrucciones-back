(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{trXN:function(t,o,e){"use strict";e.r(o),e.d(o,"PaymentsModule",function(){return q});var n=e("ofXK"),r=e("tyNb"),i=e("1G5W"),a=e("XNiG"),s=e("3Pt+"),c=e("PSD3"),l=e.n(c),m=e("ZLyn"),d=e("fXoL"),b=e("o1z6"),u=e("T9Ob"),p=e("FQRV");function v(t,o){if(1&t){const t=d.Qb();d.Pb(0,"app-table",6),d.Wb("onRecargar",function(o){return d.gc(t),d.Yb(2).recargarPagos(o)})("onCreate",function(){return d.gc(t),d.Yb(2).crearPagos()})("onEdit",function(o){return d.gc(t),d.Yb(2).editarPagos(o)})("onDelete",function(o){return d.gc(t),d.Yb(2).borrarPagos(o)}),d.Ob()}if(2&t){const t=d.Yb(2);d.dc("encabezadosTabla",t.encabezadosTabla)("filasTabla",t.tableData)("totalSection",null==t.payments?null:t.payments.length)("noImage",!0)}}function y(t,o){if(1&t&&(d.Pb(0,"div",2),d.Pb(1,"div",3),d.Pb(2,"div",4),d.kc(3,v,1,4,"app-table",5),d.Ob(),d.Ob(),d.Ob()),2&t){const t=d.Yb();d.zb(3),d.dc("ngIf",t.payments&&t.tableData)}}function g(t,o){1&t&&(d.Pb(0,"span",36),d.mc(1,"Este campo es requerido"),d.Ob())}function h(t,o){1&t&&(d.Pb(0,"span",36),d.mc(1,"Este campo es requerido"),d.Ob())}function f(t,o){1&t&&(d.Pb(0,"span",36),d.mc(1,"Este campo es requerido"),d.Ob())}function P(t,o){if(1&t&&(d.Pb(0,"option",22),d.mc(1),d.Ob()),2&t){const t=o.$implicit;d.dc("value",t),d.zb(1),d.oc(" ",t," ")}}function O(t,o){1&t&&(d.Pb(0,"span",36),d.mc(1,"Este dato es requerido"),d.Ob())}function F(t,o){if(1&t&&(d.Pb(0,"option",22),d.mc(1),d.Ob()),2&t){const t=o.$implicit;d.dc("value",t),d.zb(1),d.oc(" ",t," ")}}function z(t,o){1&t&&(d.Pb(0,"span",36),d.mc(1,"Este dato es requerido"),d.Ob())}function I(t,o){1&t&&(d.Pb(0,"span",36),d.mc(1,"Este campo es requerido"),d.Ob())}function S(t,o){1&t&&(d.Pb(0,"span",36),d.mc(1,"El valor debe ser mayor a 0"),d.Ob())}function D(t,o){1&t&&(d.Pb(0,"span",36),d.mc(1,"El monto introducido es inv\xe1lido"),d.Ob())}function j(t,o){1&t&&(d.Pb(0,"span",36),d.mc(1,"Este campo es requerido"),d.Ob())}function C(t,o){1&t&&(d.Pb(0,"span",36),d.mc(1,"El valor debe ser mayor a 0"),d.Ob())}function E(t,o){if(1&t){const t=d.Qb();d.Pb(0,"div",2),d.Pb(1,"div",3),d.Pb(2,"div",7),d.Pb(3,"h1",8),d.mc(4),d.Ob(),d.Ob(),d.Pb(5,"div",4),d.Pb(6,"form",9),d.Wb("ngSubmit",function(){return d.gc(t),d.Yb().formSubmit()}),d.Pb(7,"div",4),d.Pb(8,"div",0),d.Pb(9,"div",2),d.Pb(10,"div",10),d.Pb(11,"label",11),d.mc(12,"Descripci\xf3n*"),d.Ob(),d.Pb(13,"div",12),d.Lb(14,"input",13),d.Pb(15,"div",14),d.kc(16,g,2,0,"span",15),d.Ob(),d.Ob(),d.Ob(),d.Pb(17,"div",10),d.Pb(18,"label",16),d.mc(19,"N\xfamero de comprobante*"),d.Ob(),d.Pb(20,"div",12),d.Lb(21,"input",17),d.Pb(22,"div",14),d.kc(23,h,2,0,"span",15),d.Ob(),d.Ob(),d.Ob(),d.Pb(24,"div",10),d.Pb(25,"label",18),d.mc(26,"Fecha del pago*"),d.Ob(),d.Pb(27,"div",12),d.Lb(28,"input",19),d.Pb(29,"div",14),d.kc(30,f,2,0,"span",15),d.Ob(),d.Ob(),d.Ob(),d.Pb(31,"div",10),d.Pb(32,"label",20),d.mc(33,"Forma de pago*"),d.Ob(),d.Pb(34,"select",21),d.Pb(35,"option",22),d.mc(36," --Seleccionar forma de pago-- "),d.Ob(),d.kc(37,P,2,2,"option",23),d.Ob(),d.Pb(38,"div",14),d.kc(39,O,2,0,"span",15),d.Ob(),d.Ob(),d.Pb(40,"div",10),d.Pb(41,"label",20),d.mc(42,"Moneda de pago*"),d.Ob(),d.Pb(43,"select",24),d.Pb(44,"option",22),d.mc(45," --Seleccionar moneda de pago-- "),d.Ob(),d.kc(46,F,2,2,"option",23),d.Ob(),d.Pb(47,"div",14),d.kc(48,z,2,0,"span",15),d.Ob(),d.Ob(),d.Pb(49,"div",10),d.Pb(50,"label",25),d.mc(51,"Monto del pago*"),d.Ob(),d.Pb(52,"div",12),d.Lb(53,"input",26),d.Pb(54,"div",14),d.kc(55,I,2,0,"span",15),d.kc(56,S,2,0,"span",15),d.kc(57,D,2,0,"span",15),d.Ob(),d.Ob(),d.Ob(),d.Pb(58,"div",10),d.Pb(59,"label",27),d.mc(60,"IVA*"),d.Ob(),d.Pb(61,"div",12),d.Pb(62,"select",28),d.Pb(63,"option",22),d.mc(64,"No"),d.Ob(),d.Pb(65,"option",22),d.mc(66,"Si"),d.Ob(),d.Ob(),d.Ob(),d.Ob(),d.Pb(67,"div",10),d.Pb(68,"label"),d.mc(69),d.Zb(70,"currency"),d.Ob(),d.Ob(),d.Pb(71,"div",10),d.Pb(72,"label",29),d.mc(73,"Cotizaci\xf3n*"),d.Ob(),d.Pb(74,"div",12),d.Pb(75,"div",30),d.Lb(76,"i",31),d.Lb(77,"input",32),d.Ob(),d.Pb(78,"div",14),d.kc(79,j,2,0,"span",15),d.kc(80,C,2,0,"span",15),d.Ob(),d.Ob(),d.Ob(),d.Pb(81,"div",10),d.Pb(82,"label"),d.mc(83),d.Zb(84,"currency"),d.Ob(),d.Ob(),d.Ob(),d.Ob(),d.Ob(),d.Pb(85,"div",33),d.Pb(86,"button",34),d.mc(87," Confirmar "),d.Ob(),d.Pb(88,"button",35),d.Wb("click",function(){return d.gc(t),d.Yb().recargarPagos(!0)}),d.mc(89," Volver "),d.Ob(),d.Ob(),d.Ob(),d.Ob(),d.Ob(),d.Ob()}if(2&t){const t=d.Yb();d.zb(4),d.oc("",t.crudAction," Pago"),d.zb(2),d.dc("formGroup",t.paymentsForm),d.zb(10),d.dc("ngIf",(null==t.paymentsForm.controls.description.errors?null:t.paymentsForm.controls.description.errors.required)&&t.paymentsForm.controls.description.touched),d.zb(7),d.dc("ngIf",(null==t.paymentsForm.controls.receipt.errors?null:t.paymentsForm.controls.receipt.errors.required)&&t.paymentsForm.controls.receipt.touched),d.zb(7),d.dc("ngIf",(null==t.paymentsForm.controls.datetime.errors?null:t.paymentsForm.controls.datetime.errors.required)&&t.paymentsForm.controls.datetime.touched),d.zb(5),d.dc("value",null),d.zb(2),d.dc("ngForOf",t.formasDePago),d.zb(2),d.dc("ngIf",(null==t.paymentsForm.controls.wayToPay.errors?null:t.paymentsForm.controls.wayToPay.errors.required)&&t.paymentsForm.controls.wayToPay.touched),d.zb(5),d.dc("value",null),d.zb(2),d.dc("ngForOf",t.monedas),d.zb(2),d.dc("ngIf",(null==t.paymentsForm.controls.coin.errors?null:t.paymentsForm.controls.coin.errors.required)&&t.paymentsForm.controls.coin.touched),d.zb(7),d.dc("ngIf",(null==t.paymentsForm.controls.amount.errors?null:t.paymentsForm.controls.amount.errors.required)&&t.paymentsForm.controls.amount.touched),d.zb(1),d.dc("ngIf",(null==t.paymentsForm.controls.amount.errors?null:t.paymentsForm.controls.amount.errors.min)&&t.paymentsForm.controls.amount.touched),d.zb(1),d.dc("ngIf",(null==t.paymentsForm.controls.amount.errors?null:t.paymentsForm.controls.amount.errors.invalidAmount)&&t.paymentsForm.controls.amount.touched),d.zb(6),d.dc("value",!1),d.zb(2),d.dc("value",!0),d.zb(4),d.oc("Subtotal: ",d.ac(70,20,t.subTotal),""),d.zb(10),d.dc("ngIf",(null==t.paymentsForm.controls.cotizacionUsd.errors?null:t.paymentsForm.controls.cotizacionUsd.errors.required)&&t.paymentsForm.controls.cotizacionUsd.touched),d.zb(1),d.dc("ngIf",(null==t.paymentsForm.controls.cotizacionUsd.errors?null:t.paymentsForm.controls.cotizacionUsd.errors.min)&&t.paymentsForm.controls.cotizacionUsd.touched),d.zb(3),d.oc("Total en d\xf3lares: ",d.ac(84,22,t.totalEnDolares),"")}}const T=[{path:"",component:(()=>{class t{constructor(t,o,e,n){this.router=t,this.projectsService=o,this.fb=e,this.adminPanelCrudService=n,this.someClass=!0,this.payments=[],this.tableData=[],this.encabezadosTabla=["Descripci\xf3n","Detalle de pago","Fecha","Factura","Subtotal","IVA","Total","Cotizaci\xf3n USD","Total en USD"],this.formasDePago=["Efectivo","Transferencia"],this.monedas=["ARS","USD"],this.isCreating=!1,this.isEditing=!1,this.crudAction="",this.invalidPaymentMsg="",this.destroy$=new a.a,this.getprojectId(),this.projectID?this.createForm():this.router.navigateByUrl("/admin/proyectos")}get totalEnDolares(){var t,o,e;let n=0;return+(null===(e=null===(o=null===(t=this.paymentsForm)||void 0===t?void 0:t.controls)||void 0===o?void 0:o.total)||void 0===e?void 0:e.value)&&+this.paymentsForm.controls.cotizacionUsd.value&&(n=+this.paymentsForm.controls.total.value/+this.paymentsForm.controls.cotizacionUsd.value),n}get subTotal(){var t,o,e,n,r,i,a,s,c,l,m,d;let b=0;return(null===(e=null===(o=null===(t=this.paymentsForm)||void 0===t?void 0:t.controls)||void 0===o?void 0:o.amount)||void 0===e?void 0:e.value)&&(b="true"===this.paymentsForm.controls.iva.value?+(null===(i=null===(r=null===(n=this.paymentsForm)||void 0===n?void 0:n.controls)||void 0===r?void 0:r.amount)||void 0===i?void 0:i.value)+21*+(null===(c=null===(s=null===(a=this.paymentsForm)||void 0===a?void 0:a.controls)||void 0===s?void 0:s.amount)||void 0===c?void 0:c.value)/100:+(null===(d=null===(m=null===(l=this.paymentsForm)||void 0===l?void 0:l.controls)||void 0===m?void 0:m.amount)||void 0===d?void 0:d.value)),this.paymentsForm.controls.total.setValue(b),b}getprojectId(){var t,o,e;this.projectID=null===(e=null===(o=null===(t=this.router.getCurrentNavigation())||void 0===t?void 0:t.extras)||void 0===o?void 0:o.state)||void 0===e?void 0:e.id}createForm(){this.paymentsForm=this.fb.group({amount:[null,[s.m.required,s.m.min(1)]],receipt:["",[s.m.required]],datetime:[null,s.m.required],description:["",s.m.required],wayToPay:[null,s.m.required],coin:[null,s.m.required],iva:[!1],cotizacionUsd:[1,[s.m.required,s.m.min(1)]],total:[null,s.m.required]})}formSubmit(){if(this.paymentsForm.markAllAsTouched(),this.paymentsForm.valid){const t=this.paymentsForm.controls.datetime.value.toString(),o={projects_id:this.projectID,amount:this.paymentsForm.controls.amount.value,datetime:t,receipt:this.paymentsForm.controls.receipt.value,coin:this.paymentsForm.controls.coin.value,cotizacionUsd:this.paymentsForm.controls.cotizacionUsd.value,description:this.paymentsForm.controls.description.value,iva:"true"===this.paymentsForm.controls.iva.value,wayToPay:this.paymentsForm.controls.wayToPay.value};"Crear"===this.crudAction?this.crearPagoEnLaDb(o):this.editarPagoEnLaDb(o)}}ngOnInit(){this.getProject(),this.checkAmountValue()}checkAmountValue(){var t;null===(t=this.paymentsForm.controls.total)||void 0===t||t.valueChanges.pipe(Object(i.a)(this.destroy$)).subscribe(t=>this.validatePaymentAmount(t))}validatePaymentAmount(t){var o,e;t&&this.project.balance<t?null===(o=this.paymentsForm.controls.amount)||void 0===o||o.setErrors({invalidAmount:!0}):null===(e=this.paymentsForm.controls.amount)||void 0===e||e.setErrors(null)}getProject(){this.projectsService.getOneProject(this.projectID).pipe(Object(i.a)(this.destroy$)).subscribe(t=>{var o,e;(null===(o=null==t?void 0:t.meta)||void 0===o?void 0:o.status.toString().includes("20"))?(this.project=t.data,this.payments=null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.Payments,this.setTableData()):Object(m.e)(t)},t=>Object(m.d)(t))}setTableData(){this.payments.forEach(t=>{var o,e,n,r,i,a;return this.tableData.push({id:t.id,item2:t.description,item3:t.wayToPay,item4:null===(o=t.datetime)||void 0===o?void 0:o.substring(0,10),item6:null===(e=t.receipt)||void 0===e?void 0:e.toString(),item7:null===(n=t.amount)||void 0===n?void 0:n.toString(),item8:t.iva?"Si":"No",item9:null===(r=t.subTotal)||void 0===r?void 0:r.toString(),item10:null===(i=t.cotizacionUsd)||void 0===i?void 0:i.toString(),item11:null===(a=t.totalUsd)||void 0===a?void 0:a.toString()})})}recargarPagos(t){t&&(this.resetsetControls(),this.tableData=[],this.payments=[],this.isCreating=!1,this.isEditing=!1,this.getProject())}resetsetControls(){var t,o,e;null===(t=this.paymentsForm.controls.amount)||void 0===t||t.setValue(null),null===(o=this.paymentsForm.controls.receipt)||void 0===o||o.setValue(""),null===(e=this.paymentsForm.controls.datetime)||void 0===e||e.setValue(null)}crearPagos(){this.crudAction="Crear",this.isCreating=!0,this.isEditing=!1}crearPagoEnLaDb(t){this.projectsService.create(t,"payments").pipe(Object(i.a)(this.destroy$)).subscribe(t=>{this.recargarPagos(!0),Object(m.a)(t,"cre\xf3","pago")},t=>{this.recargarPagos(!0),Object(m.e)(t)})}editarPagos(t){this.crudAction="Editar",this.isEditing=!0,this.isCreating=!1;const o=this.payments.find(o=>o.id===t);if(o){const e=new Date(o.datetime).toISOString().substring(0,16);this.pagoId=t,this.paymentsForm.controls.amount.setValue(o.amount),this.paymentsForm.controls.receipt.setValue(o.receipt),this.paymentsForm.controls.datetime.setValue(e),this.paymentsForm.controls.coin.setValue(o.coin),this.paymentsForm.controls.cotizacionUsd.setValue(o.cotizacionUsd),this.paymentsForm.controls.description.setValue(o.description),this.paymentsForm.controls.iva.setValue(o.iva),this.paymentsForm.controls.wayToPay.setValue(o.wayToPay)}}editarPagoEnLaDb(t){this.projectsService.edit(this.pagoId,t,"payments").pipe(Object(i.a)(this.destroy$)).subscribe(t=>{this.recargarPagos(!0),Object(m.a)(t,"edit\xf3","pago")},t=>{this.recargarPagos(!0),Object(m.e)(t)})}borrarPagos(t){l.a.fire({title:"\xbfSeguro quer\xe9s elimninar el pago seleccionado?",showDenyButton:!0,confirmButtonText:"Si, borrar",denyButtonText:"No"}).then(o=>{o.isConfirmed&&this.borrarPagoEnLaDb(t)})}borrarPagoEnLaDb(t){this.adminPanelCrudService.delete(t,"payments").pipe(Object(i.a)(this.destroy$)).subscribe(t=>{this.recargarPagos(!0),Object(m.a)(t,"borr\xf3","pago")},t=>Object(m.e)(t))}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.unsubscribe()}}return t.\u0275fac=function(o){return new(o||t)(d.Kb(r.c),d.Kb(b.a),d.Kb(s.c),d.Kb(u.a))},t.\u0275cmp=d.Eb({type:t,selectors:[["app-payments"]],hostVars:2,hostBindings:function(t,o){2&t&&d.Cb("admin-panel-container",o.someClass)},decls:3,vars:2,consts:[[1,"row"],["class","col",4,"ngIf"],[1,"col"],[1,"card"],[1,"card-body"],["title","Pagos",3,"encabezadosTabla","filasTabla","totalSection","noImage","onRecargar","onCreate","onEdit","onDelete",4,"ngIf"],["title","Pagos",3,"encabezadosTabla","filasTabla","totalSection","noImage","onRecargar","onCreate","onEdit","onDelete"],[1,"card-header"],[1,"primary-dark"],[1,"form","p-t-20","form-material",3,"formGroup","ngSubmit"],[1,"form-group"],["for","descripcionInput"],[1,"input-group"],["type","text","id","descripcionInput","formControlName","description",1,"form-control"],[1,"p-2"],["class","text-danger",4,"ngIf"],["for","comprobanteInput"],["type","text","id","comprobanteInput","formControlName","receipt",1,"form-control"],["for","fechaPagoInput"],["type","datetime-local","formControlName","datetime","id","fechaPagoInput",1,"form-control"],["for","formaDePagoSelectInput"],["formControlName","wayToPay","id","formaDePagoSelectInput",1,"form-control","custom-select"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["formControlName","coin","id","formaDePagoSelectInput",1,"form-control","custom-select"],["for","amountInput"],["type","number","formControlName","amount","id","amountInput",1,"form-control"],["for","ivaSelectInput"],["formControlName","iva","id","ivaSelectInput",1,"form-control","custom-select"],["for","cotizacionInput"],[1,"d-flex","flex-row","justify-content-start","w-100","align-items-center"],[1,"ti","ti-money"],["type","number","formControlName","cotizacionUsd","id","cotizacionInput",1,"form-control","w-75"],[1,"card-footer"],["type","submit",1,"btn","btn-success","waves-effect","waves-light","m-r-10","bgc-primary-dark"],["type","button",1,"btn","btn-danger","waves-effect","waves-light","m-r-10",3,"click"],[1,"text-danger"]],template:function(t,o){1&t&&(d.Pb(0,"div",0),d.kc(1,y,4,1,"div",1),d.kc(2,E,90,24,"div",1),d.Ob()),2&t&&(d.zb(1),d.dc("ngIf",!o.isEditing&&!o.isCreating),d.zb(1),d.dc("ngIf",o.isCreating||o.isEditing))},directives:[n.m,p.a,s.n,s.h,s.e,s.b,s.g,s.d,s.l,s.i,s.o,n.l,s.j],pipes:[n.d],styles:[""]}),t})()}];let w=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=d.Ib({type:t}),t.\u0275inj=d.Hb({imports:[[r.f.forChild(T)],r.f]}),t})();var k=e("6eV/");let q=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=d.Ib({type:t}),t.\u0275inj=d.Hb({imports:[[n.c,w,s.k,k.a]]}),t})()}}]);