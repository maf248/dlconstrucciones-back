(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{qJPh:function(t,e,s){"use strict";s.r(e),s.d(e,"ManageProyectAssetsModule",function(){return E});var i=s("ofXK"),a=s("tyNb"),r=s("XNiG"),o=s("1G5W"),n=s("nYR2"),c=s("ZLyn"),b=s("AytR"),d=s("PSD3"),l=s.n(d),h=s("fXoL"),g=s("o1z6"),u=s("3Pt+"),p=s("T9Ob"),m=s("FQRV");function v(t,e){if(1&t){const t=h.Qb();h.Pb(0,"app-table",6),h.Wb("onRecargar",function(e){return h.gc(t),h.Yb(2).recargarAssets(e)})("onCreate",function(){return h.gc(t),h.Yb(2).crearAsset()})("onEdit",function(e){return h.gc(t),h.Yb(2).editarAssets(e)})("onDelete",function(e){return h.gc(t),h.Yb(2).borrarAsset(e)}),h.Ob()}if(2&t){const t=h.Yb(2);h.dc("encabezadosTabla",t.encabezadosTabla)("filasTabla",t.tableData)("totalSection",null==t.assets?null:t.assets.length)("loading",t.loading)}}function f(t,e){if(1&t&&(h.Pb(0,"div",2),h.Pb(1,"div",3),h.Pb(2,"div",4),h.kc(3,v,1,4,"app-table",5),h.Ob(),h.Ob(),h.Ob()),2&t){const t=h.Yb();h.zb(3),h.dc("ngIf",t.assets&&t.tableData)}}function A(t,e){if(1&t&&(h.Pb(0,"span",19),h.mc(1),h.Ob()),2&t){const t=h.Yb(2);h.zb(1),h.nc(t.creationImageError)}}function O(t,e){1&t&&(h.Pb(0,"span",19),h.Pb(1,"p"),h.mc(2,"Formatos aceptados para im\xe1gen: JPG, JPEG y PNG"),h.Ob(),h.Pb(3,"P"),h.mc(4,"Formatos aceptados para video: MOV, AVI, MP4, WMV, MKV"),h.Ob(),h.Ob())}function y(t,e){if(1&t){const t=h.Qb();h.Pb(0,"div",2),h.Pb(1,"div",3),h.Pb(2,"div",7),h.Pb(3,"h1",8),h.mc(4),h.Ob(),h.Ob(),h.Pb(5,"div",4),h.Pb(6,"form",9),h.Wb("ngSubmit",function(){return h.gc(t),h.Yb().formSubmit()}),h.Pb(7,"div",4),h.Pb(8,"div",10),h.Wb("click",function(){return h.gc(t),h.fc(11).click()}),h.Lb(9,"img",11),h.Pb(10,"input",12,13),h.Wb("change",function(e){return h.gc(t),h.Yb().showSelectedImage(e)}),h.Ob(),h.Pb(12,"div",14),h.kc(13,A,2,1,"span",15),h.kc(14,O,5,0,"span",15),h.Ob(),h.Ob(),h.Ob(),h.Pb(15,"div",16),h.Pb(16,"button",17),h.mc(17," Confirmar "),h.Ob(),h.Pb(18,"button",18),h.Wb("click",function(){return h.gc(t),h.Yb().recargarAssets(!0)}),h.mc(19," Volver "),h.Ob(),h.Ob(),h.Ob(),h.Ob(),h.Ob(),h.Ob()}if(2&t){const t=h.Yb();h.zb(4),h.oc("",t.crudAction," Galer\xeda"),h.zb(2),h.dc("formGroup",t.assetsForm),h.zb(3),h.dc("src",t.imageToShow,h.hc),h.zb(1),h.dc("hidden",!0),h.zb(3),h.dc("ngIf",t.creationImageError),h.zb(1),h.dc("ngIf",!t.acceptedFileTypes)}}const P=[{path:"",component:(()=>{class t{constructor(t,e,s,i){this.router=t,this.projectsService=e,this.fb=s,this.adminPanelCrudService=i,this.assets=[],this.tableData=[],this.encabezadosTabla=[],this.loading=!0,this.isCreating=!1,this.isEditing=!1,this.crudAction="",this.imageToShow="../../../../../assets/no-image.png",this.acceptedFileTypes=!0,this.creationImageError="",this.destroy$=new r.a,this.getprojectId(),this.projectID?this.createForm():this.router.navigateByUrl("/admin/proyectos")}getprojectId(){var t,e,s;this.projectID=null===(s=null===(e=null===(t=this.router.getCurrentNavigation())||void 0===t?void 0:t.extras)||void 0===e?void 0:e.state)||void 0===s?void 0:s.id}createForm(){this.assetsForm=this.fb.group({asset:[""]})}showSelectedImage(t){var e,s;if("Crear"===this.crudAction&&!(null===(e=this.assetsForm.controls.asset)||void 0===e?void 0:e.value))return void(this.creationImageError="El archivo es obligatorio");this.creationImageError="";const i=null===(s=t.target)||void 0===s?void 0:s.files[0];if(this.acceptedFileTypes="image/jpg"===i.type||"image/jpeg"===i.type||"image/png"===i.type||"video/mp4"===i.type||"video/avi"===i.type||"video/mov"===i.type||"video/wmv"===i.type||"video/mkv"===i.type,i&&this.acceptedFileTypes)if(this.fileToUpload=i,i.type.includes("image")){const t=new FileReader;t.readAsDataURL(i),t.onload=()=>this.imageToShow=t.result}else this.imageToShow="../../../../../assets/no-image-video.jpg";else this.imageToShow="../../../../../assets/no-image.png"}formSubmit(){var t;if(this.assetsForm.markAllAsTouched(),"Crear"!==this.crudAction||(null===(t=this.assetsForm.controls.asset)||void 0===t?void 0:t.value))if(this.assetsForm.valid){const t=new FormData;this.fileToUpload&&(t.append("asset",this.fileToUpload),t.append("projects_id",this.projectID.toString()),"Crear"===this.crudAction?this.crearAssetEnLaDb(t):this.editarAssetEnLaDb(t))}else console.log("form is invalid");else this.creationImageError="El archivo es obligatorio"}ngOnInit(){this.getAssets()}getAssets(){this.projectsService.getOneProject(this.projectID).pipe(Object(o.a)(this.destroy$),Object(n.a)(()=>this.loading=!1)).subscribe(t=>{var e,s;(null===(e=null==t?void 0:t.meta)||void 0===e?void 0:e.status.toString().includes("20"))?(this.project=t.data,this.assets=null===(s=null==t?void 0:t.data)||void 0===s?void 0:s.Assets,this.setTableData()):Object(c.d)(t)},t=>Object(c.c)(t))}setTableData(){this.assets.forEach(t=>this.tableData.push({id:t.id,imagen:`${b.a.API_IMAGE_URL}/${t.asset}`||"../../../../../assets/no-image.png"}))}recargarAssets(t){t&&(this.resetsetControls(),this.tableData=[],this.assets=[],this.isCreating=!1,this.isEditing=!1,this.getAssets())}resetsetControls(){var t;null===(t=this.assetsForm.controls.asset)||void 0===t||t.setValue(""),this.imageToShow="../../../../../assets/no-image.png"}crearAsset(){this.crudAction="Crear",this.isCreating=!0,this.isEditing=!1}crearAssetEnLaDb(t){this.adminPanelCrudService.create(t,"assets").pipe(Object(o.a)(this.destroy$)).subscribe(t=>{this.recargarAssets(!0),Object(c.a)(t,"cre\xf3","archivo")},t=>{this.recargarAssets(!0),Object(c.c)(t)})}editarAssets(t){this.crudAction="Editar",this.isEditing=!0,this.isCreating=!1,this.assets.find(e=>e.id===t)&&(this.assetId=t)}editarAssetEnLaDb(t){this.adminPanelCrudService.edit(this.assetId,t,"assets").pipe(Object(o.a)(this.destroy$)).subscribe(t=>{this.recargarAssets(!0),Object(c.a)(t,"edit\xf3","archivo")},t=>{this.recargarAssets(!0),Object(c.c)(t)})}borrarAsset(t){l.a.fire({title:"\xbfSeguro quer\xe9s elimninar el archivo seleccionado?",showDenyButton:!0,confirmButtonText:"Si, borrar",denyButtonText:"No"}).then(e=>{e.isConfirmed&&this.borrarAssetEnLaDb(t)})}borrarAssetEnLaDb(t){this.adminPanelCrudService.delete(t,"assets").pipe(Object(o.a)(this.destroy$)).subscribe(t=>{this.recargarAssets(!0),Object(c.a)(t,"borr\xf3","archivo")},t=>{this.recargarAssets(!0),Object(c.c)(t)})}}return t.\u0275fac=function(e){return new(e||t)(h.Kb(a.c),h.Kb(g.a),h.Kb(u.c),h.Kb(p.a))},t.\u0275cmp=h.Eb({type:t,selectors:[["app-manage-proyect-assets"]],decls:3,vars:2,consts:[[1,"row"],["class","col",4,"ngIf"],[1,"col"],[1,"card"],[1,"card-body"],["title","Galer\xeda",3,"encabezadosTabla","filasTabla","totalSection","loading","onRecargar","onCreate","onEdit","onDelete",4,"ngIf"],["title","Galer\xeda",3,"encabezadosTabla","filasTabla","totalSection","loading","onRecargar","onCreate","onEdit","onDelete"],[1,"card-header"],[1,"primary-dark"],[1,"form","p-t-20","form-material",3,"formGroup","ngSubmit"],[1,"col",3,"click"],["alt","Lote",1,"img-responsive",3,"src"],["type","file","formControlName","asset",3,"hidden","change"],["imageInput",""],[1,"p-2"],["class","text-danger",4,"ngIf"],[1,"card-footer"],["type","submit",1,"btn","btn-success","waves-effect","waves-light","m-r-10","bgc-primary-dark"],["type","button",1,"btn","btn-danger","waves-effect","waves-light","m-r-10",3,"click"],[1,"text-danger"]],template:function(t,e){1&t&&(h.Pb(0,"div",0),h.kc(1,f,4,1,"div",1),h.kc(2,y,20,6,"div",1),h.Ob()),2&t&&(h.zb(1),h.dc("ngIf",!e.isEditing&&!e.isCreating),h.zb(1),h.dc("ngIf",e.isCreating||e.isEditing))},directives:[i.l,m.a,u.n,u.h,u.e,u.b,u.g,u.d],styles:[""]}),t})()}];let I=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=h.Ib({type:t}),t.\u0275inj=h.Hb({imports:[[a.f.forChild(P)],a.f]}),t})();var j=s("6eV/");let E=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=h.Ib({type:t}),t.\u0275inj=h.Hb({imports:[[i.b,I,u.k,j.a]]}),t})()}}]);