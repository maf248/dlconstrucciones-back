(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{PRKJ:function(t,e,o){"use strict";o.r(e),o.d(e,"TrabajosRealizadosModule",function(){return R});var i=o("ofXK"),a=o("tyNb"),r=o("mrSG"),n=o("XNiG"),s=o("1G5W"),c=o("AytR"),b=o("3Pt+"),l=o("PSD3"),d=o.n(l),u=o("ZLyn"),m=o("fXoL"),p=o("N+K7"),h=o("T9Ob"),g=o("FQRV");const f=["imageInput"];function j(t,e){if(1&t){const t=m.Qb();m.Pb(0,"app-table",6),m.Wb("onRecargar",function(e){return m.gc(t),m.Yb(2).recargarTrabajos(e)})("onCreate",function(){return m.gc(t),m.Yb(2).crearTrabajoRealizado()})("onEdit",function(e){return m.gc(t),m.Yb(2).editarTrabajoRealizado(e)})("onDelete",function(e){return m.gc(t),m.Yb(2).borrarTrabajoRealizado(e)}),m.Ob()}if(2&t){const t=m.Yb(2);m.dc("title","Trabajos realizados")("filasTabla",t.tableData)("encabezadosTabla",t.encabezadosTabla)("totalSection",null==t.tableData?null:t.tableData.length)}}function v(t,e){if(1&t&&(m.Pb(0,"div",2),m.Pb(1,"div",3),m.Pb(2,"div",4),m.kc(3,j,1,4,"app-table",5),m.Ob(),m.Ob(),m.Ob()),2&t){const t=m.Yb();m.zb(3),m.dc("ngIf",t.tableData)}}function T(t,e){if(1&t){const t=m.Qb();m.Pb(0,"div",24),m.Wb("click",function(){return m.gc(t),m.Yb(2).openInput()}),m.Lb(1,"img",25),m.Ob()}if(2&t){const t=e.$implicit;m.zb(1),m.dc("src",t,m.hc)}}function O(t,e){if(1&t&&(m.Pb(0,"span",29),m.mc(1),m.Ob()),2&t){const t=m.Yb(3);m.zb(1),m.nc(t.creationImageError)}}function P(t,e){1&t&&(m.Pb(0,"span",29),m.mc(1,"Los formatos aceptados son JPG, JPEG y PNG"),m.Ob())}function y(t,e){if(1&t){const t=m.Qb();m.Nb(0),m.Pb(1,"input",26,27),m.Wb("change",function(e){return m.gc(t),m.Yb(2).showSelectedImage(e)}),m.Ob(),m.Pb(3,"div",28),m.kc(4,O,2,1,"span",19),m.kc(5,P,2,0,"span",19),m.Ob(),m.Mb()}if(2&t){const t=m.Yb(2);m.zb(1),m.dc("hidden",!0),m.zb(3),m.dc("ngIf",t.creationImageError),m.zb(1),m.dc("ngIf",!t.acceptedFileTypes)}}function F(t,e){1&t&&(m.Pb(0,"span",29),m.mc(1,"Los formatos aceptados son JPG, JPEG y PNG"),m.Ob())}function I(t,e){if(1&t){const t=m.Qb();m.Pb(0,"input",30,27),m.Wb("change",function(e){return m.gc(t),m.Yb(2).showSelectedImage(e)}),m.Ob(),m.Pb(2,"div",28),m.kc(3,F,2,0,"span",19),m.Ob()}if(2&t){const t=m.Yb(2);m.dc("hidden",!0),m.zb(3),m.dc("ngIf",!t.acceptedFileTypes)}}function z(t,e){if(1&t&&(m.Pb(0,"option",16),m.mc(1),m.Ob()),2&t){const t=e.$implicit;m.dc("value",t.id),m.zb(1),m.oc(" ",t.title," ")}}function D(t,e){1&t&&(m.Pb(0,"span",29),m.mc(1,"Este dato es requerido"),m.Ob())}function E(t,e){1&t&&(m.Pb(0,"span",29),m.mc(1,"Debe tener al menos 6 caracteres"),m.Ob())}function w(t,e){1&t&&(m.Pb(0,"span",29),m.mc(1,"Debe tener al menos 10 caracteres"),m.Ob())}function C(t,e){if(1&t&&(m.Pb(0,"div",0),m.Pb(1,"div",2),m.Pb(2,"div",14),m.Pb(3,"div",31),m.Lb(4,"input",32),m.Pb(5,"div",18),m.kc(6,E,2,0,"span",19),m.Ob(),m.Ob(),m.Ob(),m.Pb(7,"div",14),m.Pb(8,"div",31),m.Lb(9,"textarea",33),m.Pb(10,"div",18),m.kc(11,w,2,0,"span",19),m.Ob(),m.Ob(),m.Ob(),m.Ob(),m.Ob()),2&t){const t=m.Yb(2);m.zb(6),m.dc("ngIf",(null==t.jobForm.controls.title.errors?null:t.jobForm.controls.title.errors.minlength)&&t.jobForm.controls.title.touched),m.zb(5),m.dc("ngIf",(null==t.jobForm.controls.description.errors?null:t.jobForm.controls.description.errors.minlength)&&t.jobForm.controls.description.touched)}}function S(t,e){if(1&t){const t=m.Qb();m.Pb(0,"div",2),m.Pb(1,"div",3),m.Pb(2,"div",7),m.Pb(3,"h1",8),m.mc(4),m.Ob(),m.Ob(),m.Pb(5,"div",4),m.Pb(6,"form",9),m.Wb("ngSubmit",function(){return m.gc(t),m.Yb().formSubmit()}),m.Pb(7,"div",4),m.Pb(8,"div",10),m.kc(9,T,2,1,"div",11),m.kc(10,y,6,3,"ng-container",12),m.kc(11,I,4,2,"ng-template",null,13,m.lc),m.Ob(),m.Pb(13,"div",14),m.Pb(14,"label"),m.mc(15,"Categor\xeda de trabajo*"),m.Ob(),m.Pb(16,"select",15),m.Pb(17,"option",16),m.mc(18,"--Seleccionar una categor\xeda--"),m.Ob(),m.kc(19,z,2,2,"option",17),m.Ob(),m.Pb(20,"div",18),m.kc(21,D,2,0,"span",19),m.Ob(),m.Ob(),m.kc(22,C,12,2,"div",20),m.Ob(),m.Pb(23,"div",21),m.Pb(24,"button",22),m.mc(25," Confirmar "),m.Ob(),m.Pb(26,"button",23),m.Wb("click",function(){return m.gc(t),m.Yb().recargarTrabajos(!0)}),m.mc(27," Volver "),m.Ob(),m.Ob(),m.Ob(),m.Ob(),m.Ob(),m.Ob()}if(2&t){const t=m.fc(12),e=m.Yb();m.zb(4),m.oc("",e.crudAction," trabajo realizado"),m.zb(2),m.dc("formGroup",e.jobForm),m.zb(3),m.dc("ngForOf",e.imageToShow),m.zb(1),m.dc("ngIf","Crear"===e.crudAction)("ngIfElse",t),m.zb(7),m.dc("value",null),m.zb(2),m.dc("ngForOf",e.categoriaDeTrabajo),m.zb(2),m.dc("ngIf",(null==e.jobForm.controls.type.errors?null:e.jobForm.controls.type.errors.required)&&e.jobForm.controls.type.touched),m.zb(1),m.dc("ngIf","Editar"===e.crudAction)}}const k=[{path:"",component:(()=>{class t{constructor(t,e,o){this.httpSrv=t,this.adminPanelCrudService=e,this.fb=o,this.someClass=!0,this.encabezadosTabla=["T\xedtulo","Descripci\xf3n","Tipo de trabajo"],this.tableData=[],this.isCreating=!1,this.isEditing=!1,this.crudAction="",this.imageToShow=["../../../../../assets/no-image.png"],this.fileToUpload=[],this.acceptedFileTypes=!0,this.categoriaDeTrabajo=[],this.creationImageError="",this.jobs=[],this.destroy$=new n.a,this.createForm()}createForm(){this.jobForm=this.fb.group({type:[null,b.m.required],title:["",b.m.minLength(6)],description:["",b.m.minLength(10)],image:[""]})}openInput(){this.imageInput.nativeElement.click()}ngOnInit(){this.getTrabajos()}formSubmit(){var t,e,o,i;if(this.jobForm.markAllAsTouched(),"Crear"!==this.crudAction||this.jobForm.controls.image.value){if(this.jobForm.valid){const a=new FormData;a.append("title",null===(t=this.jobForm.controls.title)||void 0===t?void 0:t.value),a.append("description",null===(e=this.jobForm.controls.description)||void 0===e?void 0:e.value),a.append("type",null===(o=this.jobForm.controls.type)||void 0===o?void 0:o.value),(null===(i=this.fileToUpload)||void 0===i?void 0:i.length)&&this.fileToUpload.forEach(t=>{this.fileToUpload&&a.append("image",t)}),"Crear"===this.crudAction?this.crearTrabajoEnLaDb(a):this.editarTrabajoEnLaDb(a)}}else this.creationImageError="La im\xe1gen es obligatoria"}showSelectedImage(t){var e;return Object(r.a)(this,void 0,void 0,function*(){if("Crear"===this.crudAction&&!this.jobForm.controls.image.value)return void(this.creationImageError="La im\xe1gen es obligatoria");this.creationImageError="";let o=Array.from(null===(e=t.target)||void 0===e?void 0:e.files);o=yield this.checkAmountOfFiles(o),this.acceptedFileTypes=yield this.checkFilesType(o),o.length&&this.acceptedFileTypes?(this.imageToShow=[],this.fileToUpload=o,this.fileToUpload.forEach(t=>{const e=new FileReader;e.readAsDataURL(t),e.onload=()=>this.imageToShow.push(e.result)})):(this.fileToUpload=[],this.imageToShow=["../../../../../assets/no-image.png"])})}checkAmountOfFiles(t){return new Promise(e=>{t.length>10&&(Object(u.b)("Atenci\xf3n","No se pueden subir m\xe1s de 10 im\xe1genes","OK","info"),t=t.slice(0,10)),e(t)})}checkFilesType(t){return new Promise(e=>{let o="valido";t.forEach(t=>{t.type.includes("image/jpg")||t.type.includes("image/jpeg")||t.type.includes("image/png")||(o=!1)}),e("valido"===o)})}getTrabajos(){this.httpSrv.getTypesOfJob().pipe(Object(s.a)(this.destroy$)).subscribe(t=>{for(const e of t.data)this.categoriaDeTrabajo.push(e),this.httpSrv.getOneTypeOfJob(e.id.toString()).pipe(Object(s.a)(this.destroy$)).subscribe(t=>{t.meta.status.toString().includes("20")?this.setTableData(t):Object(u.e)(t)},t=>Object(u.d)(t))})}setTableData(t){var e;null===(e=null==t?void 0:t.data)||void 0===e||e.Jobs.forEach(e=>{this.tableData.push({imagen:`${c.a.API_IMAGE_URL}/${e.image}`,item2:e.title?e.title:"Vac\xedo",item3:e.description?e.description:"Vac\xedo",item4:t.data.title,id:e.id}),this.jobs.push(e)})}recargarTrabajos(t){t&&(this.resetsetControls(),this.tableData=[],this.categoriaDeTrabajo=[],this.fileToUpload=[],this.jobs=[],this.isCreating=!1,this.isEditing=!1,this.getTrabajos())}resetsetControls(){this.jobForm.controls.title.setValue(""),this.jobForm.controls.description.setValue(""),this.jobForm.controls.type.setValue(""),this.jobForm.controls.image.setValue(""),this.imageToShow=["../../../../../assets/no-image.png"]}crearTrabajoRealizado(){this.crudAction="Crear",this.isCreating=!0,this.isEditing=!1}crearTrabajoEnLaDb(t){this.adminPanelCrudService.create(t,"jobs").pipe(Object(s.a)(this.destroy$)).subscribe(t=>{this.recargarTrabajos(!0),Object(u.a)(t,"cre\xf3","trabajo realizado")},t=>{this.recargarTrabajos(!0),Object(u.d)(t)})}editarTrabajoRealizado(t){var e;this.crudAction="Editar",this.isEditing=!0,this.isCreating=!1;const o=null===(e=this.jobs)||void 0===e?void 0:e.find(e=>e.id===t);o&&(this.trabajoID=o.id,this.jobForm.controls.title.setValue(o.title),this.jobForm.controls.description.setValue(o.description),this.jobForm.controls.type.setValue(o.types_id),this.imageToShow=[`${c.a.API_IMAGE_URL}/${o.image}`])}editarTrabajoEnLaDb(t){this.adminPanelCrudService.edit(this.trabajoID,t,"jobs").pipe(Object(s.a)(this.destroy$)).subscribe(t=>{this.recargarTrabajos(!0),Object(u.a)(t,"edit\xf3","trabajo realizado")},t=>{this.recargarTrabajos(!0),Object(u.d)(t)})}borrarTrabajoRealizado(t){d.a.fire({title:"\xbfSeguro quer\xe9s elimninar el trabajo realizado seleccionado?",showDenyButton:!0,confirmButtonText:"Si, borrar",denyButtonText:"No"}).then(e=>{e.isConfirmed&&this.borrarTrabajoDeLaDb(t)})}borrarTrabajoDeLaDb(t){this.adminPanelCrudService.delete(t,"jobs").pipe(Object(s.a)(this.destroy$)).subscribe(t=>{this.recargarTrabajos(!0),Object(u.a)(t,"borr\xf3","trabajo realizado")},t=>Object(u.d)(t))}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(m.Kb(p.a),m.Kb(h.a),m.Kb(b.c))},t.\u0275cmp=m.Eb({type:t,selectors:[["app-trabajos-realizados"]],viewQuery:function(t,e){if(1&t&&m.rc(f,1),2&t){let t;m.ec(t=m.Xb())&&(e.imageInput=t.first)}},hostVars:2,hostBindings:function(t,e){2&t&&m.Cb("admin-panel-container",e.someClass)},decls:3,vars:2,consts:[[1,"row"],["class","col",4,"ngIf"],[1,"col"],[1,"card"],[1,"card-body"],[3,"title","filasTabla","encabezadosTabla","totalSection","onRecargar","onCreate","onEdit","onDelete",4,"ngIf"],[3,"title","filasTabla","encabezadosTabla","totalSection","onRecargar","onCreate","onEdit","onDelete"],[1,"card-header"],[1,"primary-dark"],[1,"form","p-t-20","form-material",3,"formGroup","ngSubmit"],[1,"row","justify-content-center"],["class","col-md-4 mb-2",3,"click",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["isEditingTemplate",""],[1,"form-group"],["formControlName","type",1,"form-control","custom-select"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"p-2"],["class","text-danger",4,"ngIf"],["class","row",4,"ngIf"],[1,"card-footer"],["type","submit",1,"btn","btn-success","waves-effect","waves-light","m-r-10","bgc-primary-dark"],["type","button",1,"btn","btn-danger","waves-effect","waves-light","m-r-10",3,"click"],[1,"col-md-4","mb-2",3,"click"],["alt","Servicio realizado",1,"img-responsive","image-gallery",3,"src"],["type","file","formControlName","image","multiple","",3,"hidden","change"],["imageInput",""],[1,"p-2","text-center"],[1,"text-danger"],["type","file","formControlName","image",3,"hidden","change"],[1,"input-group"],["type","text","id","exampleInputuname2","placeholder","T\xedtulo","formControlName","title",1,"form-control"],["type","text","id","exampleInputuname2","placeholder","Descripci\xf3n","formControlName","description","rows","5",1,"form-control"]],template:function(t,e){1&t&&(m.Pb(0,"div",0),m.kc(1,v,4,1,"div",1),m.kc(2,S,28,9,"div",1),m.Ob()),2&t&&(m.zb(1),m.dc("ngIf",!e.isEditing&&!e.isCreating),m.zb(1),m.dc("ngIf",e.isCreating||e.isEditing))},directives:[i.m,g.a,b.n,b.h,b.e,i.l,b.l,b.g,b.d,b.i,b.o,b.b],styles:[""]}),t})()}];let A=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=m.Ib({type:t}),t.\u0275inj=m.Hb({imports:[[a.f.forChild(k)],a.f]}),t})();var L=o("6eV/");let R=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=m.Ib({type:t}),t.\u0275inj=m.Hb({imports:[[i.c,A,L.a,b.k]]}),t})()}}]);