(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{trXN:function(t,o,e){"use strict";e.r(o),e.d(o,"PaymentsModule",function(){return q});var n=e("ofXK"),r=e("tyNb"),i=e("1G5W"),a=e("XNiG"),s=e("3Pt+"),c=e("PSD3"),l=e.n(c),m=e("ZLyn"),u=e("fXoL"),d=e("o1z6"),b=e("T9Ob"),p=e("FQRV");function v(t,o){if(1&t){const t=u.Qb();u.Pb(0,"app-table",6),u.Wb("onRecargar",function(o){return u.gc(t),u.Yb(2).recargarPagos(o)})("onCreate",function(){return u.gc(t),u.Yb(2).crearPagos()})("onEdit",function(o){return u.gc(t),u.Yb(2).editarPagos(o)})("onDelete",function(o){return u.gc(t),u.Yb(2).borrarPagos(o)}),u.Ob()}if(2&t){const t=u.Yb(2);u.dc("encabezadosTabla",t.encabezadosTabla)("filasTabla",t.tableData)("totalSection",null==t.payments?null:t.payments.length)("noImage",!0)}}function h(t,o){if(1&t&&(u.Pb(0,"div",2),u.Pb(1,"div",3),u.Pb(2,"div",4),u.kc(3,v,1,4,"app-table",5),u.Ob(),u.Ob(),u.Ob()),2&t){const t=u.Yb();u.zb(3),u.dc("ngIf",t.payments&&t.tableData)}}function y(t,o){1&t&&(u.Pb(0,"span",35),u.mc(1,"Este campo es requerido"),u.Ob())}function g(t,o){1&t&&(u.Pb(0,"span",35),u.mc(1,"Este campo es requerido"),u.Ob())}function f(t,o){1&t&&(u.Pb(0,"span",35),u.mc(1,"Este campo es requerido"),u.Ob())}function P(t,o){if(1&t&&(u.Pb(0,"option",22),u.mc(1),u.Ob()),2&t){const t=o.$implicit;u.dc("value",t),u.zb(1),u.oc(" ",t," ")}}function F(t,o){1&t&&(u.Pb(0,"span",35),u.mc(1,"Este dato es requerido"),u.Ob())}function O(t,o){if(1&t&&(u.Pb(0,"option",22),u.mc(1),u.Ob()),2&t){const t=o.$implicit;u.dc("value",t),u.zb(1),u.oc(" ",t," ")}}function z(t,o){1&t&&(u.Pb(0,"span",35),u.mc(1,"Este dato es requerido"),u.Ob())}function I(t,o){1&t&&(u.Pb(0,"span",35),u.mc(1,"Este campo es requerido"),u.Ob())}function S(t,o){1&t&&(u.Pb(0,"span",35),u.mc(1,"El valor debe ser mayor a 0"),u.Ob())}function D(t,o){1&t&&(u.Pb(0,"span",35),u.mc(1,"El monto introducido es inv\xe1lido"),u.Ob())}function C(t,o){if(1&t&&(u.Nb(0),u.Pb(1,"label",36),u.Lb(2,"i",37),u.mc(3),u.Ob(),u.Mb()),2&t){const t=u.Yb(2);u.zb(3),u.nc(t.paymentsForm.controls.cotizacionUsd.value)}}function T(t,o){1&t&&(u.Pb(0,"span",35),u.mc(1,"Este campo es requerido"),u.Ob())}function E(t,o){1&t&&(u.Pb(0,"span",35),u.mc(1,"El valor debe ser mayor a 0"),u.Ob())}function j(t,o){if(1&t&&(u.Pb(0,"div",38),u.Lb(1,"i",37),u.Lb(2,"input",39),u.Ob(),u.Pb(3,"div",14),u.kc(4,T,2,0,"span",15),u.kc(5,E,2,0,"span",15),u.Ob()),2&t){const t=u.Yb(2);u.zb(4),u.dc("ngIf",(null==t.paymentsForm.controls.cotizacionUsd.errors?null:t.paymentsForm.controls.cotizacionUsd.errors.required)&&t.paymentsForm.controls.cotizacionUsd.touched),u.zb(1),u.dc("ngIf",(null==t.paymentsForm.controls.cotizacionUsd.errors?null:t.paymentsForm.controls.cotizacionUsd.errors.min)&&t.paymentsForm.controls.cotizacionUsd.touched)}}function w(t,o){if(1&t){const t=u.Qb();u.Pb(0,"div",2),u.Pb(1,"div",3),u.Pb(2,"div",7),u.Pb(3,"h1",8),u.mc(4),u.Ob(),u.Ob(),u.Pb(5,"div",4),u.Pb(6,"form",9),u.Wb("ngSubmit",function(){return u.gc(t),u.Yb().formSubmit()}),u.Pb(7,"div",4),u.Pb(8,"div",0),u.Pb(9,"div",2),u.Pb(10,"div",10),u.Pb(11,"label",11),u.mc(12,"Descripci\xf3n*"),u.Ob(),u.Pb(13,"div",12),u.Lb(14,"input",13),u.Pb(15,"div",14),u.kc(16,y,2,0,"span",15),u.Ob(),u.Ob(),u.Ob(),u.Pb(17,"div",10),u.Pb(18,"label",16),u.mc(19,"N\xfamero de comprobante*"),u.Ob(),u.Pb(20,"div",12),u.Lb(21,"input",17),u.Pb(22,"div",14),u.kc(23,g,2,0,"span",15),u.Ob(),u.Ob(),u.Ob(),u.Pb(24,"div",10),u.Pb(25,"label",18),u.mc(26,"Fecha del pago*"),u.Ob(),u.Pb(27,"div",12),u.Lb(28,"input",19),u.Pb(29,"div",14),u.kc(30,f,2,0,"span",15),u.Ob(),u.Ob(),u.Ob(),u.Pb(31,"div",10),u.Pb(32,"label",20),u.mc(33,"Forma de pago*"),u.Ob(),u.Pb(34,"select",21),u.Pb(35,"option",22),u.mc(36," --Seleccionar forma de pago-- "),u.Ob(),u.kc(37,P,2,2,"option",23),u.Ob(),u.Pb(38,"div",14),u.kc(39,F,2,0,"span",15),u.Ob(),u.Ob(),u.Pb(40,"div",10),u.Pb(41,"label",20),u.mc(42,"Moneda de pago*"),u.Ob(),u.Pb(43,"select",24),u.Pb(44,"option",22),u.mc(45," --Seleccionar moneda de pago-- "),u.Ob(),u.kc(46,O,2,2,"option",23),u.Ob(),u.Pb(47,"div",14),u.kc(48,z,2,0,"span",15),u.Ob(),u.Ob(),u.Pb(49,"div",10),u.Pb(50,"label",25),u.mc(51,"Monto del pago*"),u.Ob(),u.Pb(52,"div",12),u.Lb(53,"input",26),u.Pb(54,"div",14),u.kc(55,I,2,0,"span",15),u.kc(56,S,2,0,"span",15),u.kc(57,D,2,0,"span",15),u.Ob(),u.Ob(),u.Ob(),u.Pb(58,"div",10),u.Pb(59,"label",27),u.mc(60,"IVA*"),u.Ob(),u.Pb(61,"div",12),u.Pb(62,"select",28),u.Pb(63,"option",22),u.mc(64,"No"),u.Ob(),u.Pb(65,"option",22),u.mc(66,"Si"),u.Ob(),u.Ob(),u.Ob(),u.Ob(),u.Pb(67,"div",10),u.Pb(68,"label"),u.mc(69),u.Ob(),u.Ob(),u.Pb(70,"div",10),u.Pb(71,"label",29),u.mc(72,"Cotizaci\xf3n*"),u.Ob(),u.Pb(73,"div",12),u.kc(74,C,4,1,"ng-container",30),u.kc(75,j,6,2,"ng-template",null,31,u.lc),u.Ob(),u.Ob(),u.Pb(77,"div",10),u.Pb(78,"label"),u.mc(79),u.Zb(80,"currency"),u.Ob(),u.Ob(),u.Ob(),u.Ob(),u.Ob(),u.Pb(81,"div",32),u.Pb(82,"button",33),u.mc(83," Confirmar "),u.Ob(),u.Pb(84,"button",34),u.Wb("click",function(){return u.gc(t),u.Yb().recargarPagos(!0)}),u.mc(85," Volver "),u.Ob(),u.Ob(),u.Ob(),u.Ob(),u.Ob(),u.Ob()}if(2&t){const t=u.fc(76),o=u.Yb();u.zb(4),u.oc("",o.crudAction," Pago"),u.zb(2),u.dc("formGroup",o.paymentsForm),u.zb(10),u.dc("ngIf",(null==o.paymentsForm.controls.description.errors?null:o.paymentsForm.controls.description.errors.required)&&o.paymentsForm.controls.description.touched),u.zb(7),u.dc("ngIf",(null==o.paymentsForm.controls.receipt.errors?null:o.paymentsForm.controls.receipt.errors.required)&&o.paymentsForm.controls.receipt.touched),u.zb(7),u.dc("ngIf",(null==o.paymentsForm.controls.datetime.errors?null:o.paymentsForm.controls.datetime.errors.required)&&o.paymentsForm.controls.datetime.touched),u.zb(5),u.dc("value",null),u.zb(2),u.dc("ngForOf",o.formasDePago),u.zb(2),u.dc("ngIf",(null==o.paymentsForm.controls.wayToPay.errors?null:o.paymentsForm.controls.wayToPay.errors.required)&&o.paymentsForm.controls.wayToPay.touched),u.zb(5),u.dc("value",null),u.zb(2),u.dc("ngForOf",o.monedas),u.zb(2),u.dc("ngIf",(null==o.paymentsForm.controls.coin.errors?null:o.paymentsForm.controls.coin.errors.required)&&o.paymentsForm.controls.coin.touched),u.zb(7),u.dc("ngIf",(null==o.paymentsForm.controls.amount.errors?null:o.paymentsForm.controls.amount.errors.required)&&o.paymentsForm.controls.amount.touched),u.zb(1),u.dc("ngIf",(null==o.paymentsForm.controls.amount.errors?null:o.paymentsForm.controls.amount.errors.min)&&o.paymentsForm.controls.amount.touched),u.zb(1),u.dc("ngIf",(null==o.paymentsForm.controls.amount.errors?null:o.paymentsForm.controls.amount.errors.invalidAmount)&&o.paymentsForm.controls.amount.touched),u.zb(6),u.dc("value",!1),u.zb(2),u.dc("value",!0),u.zb(4),u.oc("Subtotal: ",o.setCoinFormatAcordingToPaymentMethod(o.subTotal.toString(),o.paymentsForm.controls.coin.value),""),u.zb(5),u.dc("ngIf","USD"===o.paymentsForm.controls.coin.value)("ngIfElse",t),u.zb(5),u.oc("Total en d\xf3lares: ",u.ac(80,20,o.totalEnDolares),"")}}const U=[{path:"",component:(()=>{class t{constructor(t,o,e,n,r){this.router=t,this.projectsService=o,this.fb=e,this.adminPanelCrudService=n,this.currencyPipe=r,this.someClass=!0,this.payments=[],this.tableData=[],this.encabezadosTabla=["Descripci\xf3n","Detalle de pago","Fecha","Factura","Moneda","Subtotal","IVA","Total","Cotizaci\xf3n USD","Total en USD"],this.formasDePago=["Efectivo","Transferencia"],this.monedas=["ARS","USD"],this.isCreating=!1,this.isEditing=!1,this.crudAction="",this.invalidPaymentMsg="",this.destroy$=new a.a,this.getprojectId(),this.projectID?this.createForm():this.router.navigateByUrl("/admin/proyectos")}get totalEnDolares(){var t,o,e;let n=0;return+(null===(e=null===(o=null===(t=this.paymentsForm)||void 0===t?void 0:t.controls)||void 0===o?void 0:o.total)||void 0===e?void 0:e.value)&&+this.paymentsForm.controls.cotizacionUsd.value&&(n=+this.paymentsForm.controls.total.value/+this.paymentsForm.controls.cotizacionUsd.value),n}get subTotal(){var t,o,e,n,r,i,a,s,c,l,m,u;let d=0;return(null===(e=null===(o=null===(t=this.paymentsForm)||void 0===t?void 0:t.controls)||void 0===o?void 0:o.amount)||void 0===e?void 0:e.value)&&(d="true"===this.paymentsForm.controls.iva.value?+(null===(i=null===(r=null===(n=this.paymentsForm)||void 0===n?void 0:n.controls)||void 0===r?void 0:r.amount)||void 0===i?void 0:i.value)-21*+(null===(c=null===(s=null===(a=this.paymentsForm)||void 0===a?void 0:a.controls)||void 0===s?void 0:s.amount)||void 0===c?void 0:c.value)/100:+(null===(u=null===(m=null===(l=this.paymentsForm)||void 0===l?void 0:l.controls)||void 0===m?void 0:m.amount)||void 0===u?void 0:u.value)),this.paymentsForm.controls.total.setValue(d),d}getprojectId(){var t,o,e;this.projectID=null===(e=null===(o=null===(t=this.router.getCurrentNavigation())||void 0===t?void 0:t.extras)||void 0===o?void 0:o.state)||void 0===e?void 0:e.id}createForm(){this.paymentsForm=this.fb.group({amount:[null,[s.m.required,s.m.min(1)]],receipt:["",[s.m.required]],datetime:[null,s.m.required],description:["",s.m.required],wayToPay:[null,s.m.required],coin:[null,s.m.required],iva:[!1],cotizacionUsd:[1,[s.m.required,s.m.min(1)]],total:[null,s.m.required]})}formSubmit(){if(this.paymentsForm.markAllAsTouched(),this.paymentsForm.valid){const t=this.paymentsForm.controls.datetime.value.toString(),o={projects_id:this.projectID,amount:this.paymentsForm.controls.amount.value,datetime:t,receipt:this.paymentsForm.controls.receipt.value,coin:this.paymentsForm.controls.coin.value,description:this.paymentsForm.controls.description.value,iva:"true"===this.paymentsForm.controls.iva.value,wayToPay:this.paymentsForm.controls.wayToPay.value};"ARS"===this.paymentsForm.controls.coin.value&&(o.cotizacionUsd=this.paymentsForm.controls.cotizacionUsd.value),"Crear"===this.crudAction?this.crearPagoEnLaDb(o):this.editarPagoEnLaDb(o)}}ngOnInit(){this.getProject(),this.checkAmountValue(),this.checkCotizacionValue()}checkCotizacionValue(){this.paymentsForm.controls.coin.valueChanges.pipe(Object(i.a)(this.destroy$)).subscribe(t=>{"USD"!==t&&t||this.paymentsForm.controls.cotizacionUsd.setValue(1)})}checkAmountValue(){var t;null===(t=this.paymentsForm.controls.total)||void 0===t||t.valueChanges.pipe(Object(i.a)(this.destroy$)).subscribe(t=>this.validatePaymentAmount())}validatePaymentAmount(){var t,o;this.totalEnDolares&&this.project.balance<this.totalEnDolares?null===(t=this.paymentsForm.controls.amount)||void 0===t||t.setErrors({invalidAmount:!0}):null===(o=this.paymentsForm.controls.amount)||void 0===o||o.setErrors(null)}setCoinFormatAcordingToPaymentMethod(t,o){return"ARS"===o?this.currencyPipe.transform(t):(t=this.currencyPipe.transform(t,"USD","code")).substring(0,3)+" "+t.substring(3,t.length)}getProject(){this.projectsService.getOneProject(this.projectID).pipe(Object(i.a)(this.destroy$)).subscribe(t=>{var o,e;(null===(o=null==t?void 0:t.meta)||void 0===o?void 0:o.status.toString().includes("20"))?(this.project=t.data,this.payments=null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.Payments,this.setTableData()):Object(m.e)(t)},t=>Object(m.d)(t))}setTableData(){this.payments.forEach(t=>{var o,e,n,r;return this.tableData.push({id:t.id,item2:t.description,item3:t.wayToPay,item4:null===(o=t.datetime)||void 0===o?void 0:o.substring(0,10),item6:t.receipt,item7:t.coin,item8:this.setCoinFormatAcordingToPaymentMethod(t.amount.toString(),t.coin),item9:"true"===t.iva?"Si":"No",item10:this.setCoinFormatAcordingToPaymentMethod(t.subTotal?t.subTotal.toString():null===(e=t.amount)||void 0===e?void 0:e.toString(),t.coin),item11:this.currencyPipe.transform(t.cotizacionUsd?null===(n=t.cotizacionUsd)||void 0===n?void 0:n.toString():1),item12:this.setDolarCodeFormat(null===(r=t.totalUsd)||void 0===r?void 0:r.toString())})})}setDolarCodeFormat(t){return(t=this.currencyPipe.transform(t,"USD","code")).substring(0,3)+" "+t.substring(3,t.length)}setFormatAcordingToPaymentMethod(t,o){return(t="USD"===o?this.currencyPipe.transform(t,"USD","code"):this.currencyPipe.transform(t)).includes("USD")&&(t=t.substring(0,3)+" "+t.substring(3,t.length)),t}recargarPagos(t){t&&(this.resetsetControls(),this.tableData=[],this.payments=[],this.isCreating=!1,this.isEditing=!1,this.getProject())}resetsetControls(){var t,o,e,n,r,i,a,s,c;null===(t=this.paymentsForm.controls.amount)||void 0===t||t.setValue(null),null===(o=this.paymentsForm.controls.receipt)||void 0===o||o.setValue(""),null===(e=this.paymentsForm.controls.datetime)||void 0===e||e.setValue(null),null===(n=this.paymentsForm.controls.description)||void 0===n||n.setValue(""),null===(r=this.paymentsForm.controls.wayToPay)||void 0===r||r.setValue(null),null===(i=this.paymentsForm.controls.coin)||void 0===i||i.setValue(null),null===(a=this.paymentsForm.controls.iva)||void 0===a||a.setValue(!1),null===(s=this.paymentsForm.controls.cotizacionUsd)||void 0===s||s.setValue(1),null===(c=this.paymentsForm.controls.total)||void 0===c||c.setValue(null)}crearPagos(){this.crudAction="Crear",this.isCreating=!0,this.isEditing=!1}crearPagoEnLaDb(t){this.projectsService.create(t,"payments").pipe(Object(i.a)(this.destroy$)).subscribe(t=>{this.recargarPagos(!0),Object(m.a)(t,"cre\xf3","pago")},t=>{this.recargarPagos(!0),Object(m.e)(t)})}editarPagos(t){this.crudAction="Editar",this.isEditing=!0,this.isCreating=!1;const o=this.payments.find(o=>o.id===t);if(o){const e=new Date(o.datetime).toISOString().substring(0,16);this.pagoId=t,this.paymentsForm.controls.amount.setValue(o.amount),this.paymentsForm.controls.receipt.setValue(o.receipt),this.paymentsForm.controls.datetime.setValue(e),this.paymentsForm.controls.coin.setValue(o.coin),this.paymentsForm.controls.cotizacionUsd.setValue(o.cotizacionUsd),this.paymentsForm.controls.description.setValue(o.description),this.paymentsForm.controls.iva.setValue(o.iva),this.paymentsForm.controls.wayToPay.setValue(o.wayToPay)}}editarPagoEnLaDb(t){this.projectsService.edit(this.pagoId,t,"payments").pipe(Object(i.a)(this.destroy$)).subscribe(t=>{this.recargarPagos(!0),Object(m.a)(t,"edit\xf3","pago")},t=>{this.recargarPagos(!0),Object(m.e)(t)})}borrarPagos(t){l.a.fire({title:"\xbfSeguro quer\xe9s elimninar el pago seleccionado?",showDenyButton:!0,confirmButtonText:"Si, borrar",denyButtonText:"No"}).then(o=>{o.isConfirmed&&this.borrarPagoEnLaDb(t)})}borrarPagoEnLaDb(t){this.adminPanelCrudService.delete(t,"payments").pipe(Object(i.a)(this.destroy$)).subscribe(t=>{this.recargarPagos(!0),Object(m.a)(t,"borr\xf3","pago")},t=>Object(m.e)(t))}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.unsubscribe()}}return t.\u0275fac=function(o){return new(o||t)(u.Kb(r.c),u.Kb(d.a),u.Kb(s.c),u.Kb(b.a),u.Kb(n.d))},t.\u0275cmp=u.Eb({type:t,selectors:[["app-payments"]],hostVars:2,hostBindings:function(t,o){2&t&&u.Cb("admin-panel-container",o.someClass)},features:[u.yb([n.d])],decls:3,vars:2,consts:[[1,"row"],["class","col",4,"ngIf"],[1,"col"],[1,"card"],[1,"card-body"],["title","Pagos",3,"encabezadosTabla","filasTabla","totalSection","noImage","onRecargar","onCreate","onEdit","onDelete",4,"ngIf"],["title","Pagos",3,"encabezadosTabla","filasTabla","totalSection","noImage","onRecargar","onCreate","onEdit","onDelete"],[1,"card-header"],[1,"primary-dark"],[1,"form","p-t-20","form-material",3,"formGroup","ngSubmit"],[1,"form-group"],["for","descripcionInput"],[1,"input-group"],["type","text","id","descripcionInput","formControlName","description",1,"form-control"],[1,"p-2"],["class","text-danger",4,"ngIf"],["for","comprobanteInput"],["type","text","id","comprobanteInput","formControlName","receipt",1,"form-control"],["for","fechaPagoInput"],["type","datetime-local","formControlName","datetime","id","fechaPagoInput",1,"form-control"],["for","formaDePagoSelectInput"],["formControlName","wayToPay","id","formaDePagoSelectInput",1,"form-control","custom-select"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["formControlName","coin","id","formaDePagoSelectInput",1,"form-control","custom-select"],["for","amountInput"],["type","number","formControlName","amount","id","amountInput",1,"form-control"],["for","ivaSelectInput"],["formControlName","iva","id","ivaSelectInput",1,"form-control","custom-select"],["for","cotizacionInput"],[4,"ngIf","ngIfElse"],["usdTemplate",""],[1,"card-footer"],["type","submit",1,"btn","btn-success","waves-effect","waves-light","m-r-10","bgc-primary-dark"],["type","button",1,"btn","btn-danger","waves-effect","waves-light","m-r-10",3,"click"],[1,"text-danger"],[1,"cotizacion-label"],[1,"ti","ti-money"],[1,"d-flex","flex-row","justify-content-start","w-100","align-items-center"],["type","number","formControlName","cotizacionUsd","id","cotizacionInput",1,"form-control","w-75"]],template:function(t,o){1&t&&(u.Pb(0,"div",0),u.kc(1,h,4,1,"div",1),u.kc(2,w,86,22,"div",1),u.Ob()),2&t&&(u.zb(1),u.dc("ngIf",!o.isEditing&&!o.isCreating),u.zb(1),u.dc("ngIf",o.isCreating||o.isEditing))},directives:[n.m,p.a,s.n,s.h,s.e,s.b,s.g,s.d,s.l,s.i,s.o,n.l,s.j],pipes:[n.d],styles:[".cotizacion-label[_ngcontent-%COMP%]{margin-top:4px;margin-bottom:10px}"]}),t})()}];let k=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=u.Ib({type:t}),t.\u0275inj=u.Hb({imports:[[r.f.forChild(U)],r.f]}),t})();var V=e("6eV/");let q=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=u.Ib({type:t}),t.\u0275inj=u.Hb({imports:[[n.c,k,s.k,V.a]]}),t})()}}]);