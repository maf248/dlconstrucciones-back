(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{CQpn:function(e,i,t){"use strict";t.r(i),t.d(i,"ServiciosPicturesModule",function(){return k});var r=t("ofXK"),c=t("tyNb"),s=t("XNiG"),n=t("1G5W"),a=t("3Pt+"),o=t("PSD3"),b=t.n(o),d=t("ZLyn"),u=t("AytR"),l=t("fXoL"),h=t("N+K7"),g=t("T9Ob"),m=t("FQRV");const p=["imageInput"];function f(e,i){if(1&e){const e=l.Qb();l.Pb(0,"app-table",6),l.Wb("onRecargar",function(i){return l.gc(e),l.Yb(2).recargarServicePictures(i)})("onCreate",function(){return l.gc(e),l.Yb(2).crearPictures()})("onEdit",function(i){return l.gc(e),l.Yb(2).editarPictures(i)})("onDelete",function(i){return l.gc(e),l.Yb(2).borrarPictures(i)}),l.Ob()}if(2&e){const e=l.Yb(2);l.dc("title","Im\xe1genes de un servicio")("filasTabla",e.tableData)("encabezadosTabla",e.encabezadosTabla)("totalSection",null==e.tableData?null:e.tableData.length)}}function v(e,i){if(1&e&&(l.Pb(0,"div",2),l.Pb(1,"div",3),l.Pb(2,"div",4),l.kc(3,f,1,4,"app-table",5),l.Ob(),l.Ob(),l.Ob()),2&e){const e=l.Yb();l.zb(3),l.dc("ngIf",e.tableData)}}function P(e,i){if(1&e&&(l.Pb(0,"label"),l.mc(1),l.Ob()),2&e){const e=i.$implicit;l.zb(1),l.oc("Categor\xeda de servicio: ",e.title,"")}}function O(e,i){if(1&e){const e=l.Qb();l.Pb(0,"div",19),l.Wb("click",function(){return l.gc(e),l.Yb(2).openInput()}),l.Lb(1,"img",20),l.Ob()}if(2&e){const e=i.$implicit;l.zb(1),l.dc("src",e,l.hc)}}function S(e,i){if(1&e&&(l.Pb(0,"span",25),l.mc(1),l.Ob()),2&e){const e=l.Yb(3);l.zb(1),l.nc(e.creationImageError)}}function y(e,i){1&e&&(l.Pb(0,"span",25),l.mc(1,"Los formatos aceptados son JPG, JPEG y PNG"),l.Ob())}function I(e,i){if(1&e){const e=l.Qb();l.Nb(0),l.Pb(1,"input",21,22),l.Wb("change",function(i){return l.gc(e),l.Yb(2).showSelectedImage(i)}),l.Ob(),l.Pb(3,"div",23),l.kc(4,S,2,1,"span",24),l.kc(5,y,2,0,"span",24),l.Ob(),l.Mb()}if(2&e){const e=l.Yb(2);l.zb(1),l.dc("hidden",!0),l.zb(3),l.dc("ngIf",e.creationImageError),l.zb(1),l.dc("ngIf",!e.acceptedFileTypes)}}function C(e,i){1&e&&(l.Pb(0,"span",25),l.mc(1,"Los formatos aceptados son JPG, JPEG y PNG"),l.Ob())}function E(e,i){if(1&e){const e=l.Qb();l.Pb(0,"input",26,22),l.Wb("change",function(i){return l.gc(e),l.Yb(2).showSelectedImage(i)}),l.Ob(),l.Pb(2,"div",23),l.kc(3,C,2,0,"span",24),l.Ob()}if(2&e){const e=l.Yb(2);l.dc("hidden",!0),l.zb(3),l.dc("ngIf",!e.acceptedFileTypes)}}function w(e,i){if(1&e){const e=l.Qb();l.Pb(0,"div",2),l.Pb(1,"div",3),l.Pb(2,"div",7),l.Pb(3,"h1",8),l.mc(4),l.Ob(),l.Ob(),l.Pb(5,"div",4),l.Pb(6,"form",9),l.Wb("ngSubmit",function(){return l.gc(e),l.Yb().formSubmit()}),l.Pb(7,"div",4),l.Pb(8,"div",10),l.kc(9,P,2,1,"label",11),l.Ob(),l.Pb(10,"div",12),l.kc(11,O,2,1,"div",13),l.kc(12,I,6,3,"ng-container",14),l.kc(13,E,4,2,"ng-template",null,15,l.lc),l.Ob(),l.Ob(),l.Pb(15,"div",16),l.Pb(16,"button",17),l.mc(17," Confirmar "),l.Ob(),l.Pb(18,"button",18),l.Wb("click",function(){return l.gc(e),l.Yb().recargarServicePictures(!0)}),l.mc(19," Volver "),l.Ob(),l.Ob(),l.Ob(),l.Ob(),l.Ob(),l.Ob()}if(2&e){const e=l.fc(14),i=l.Yb();l.zb(4),l.oc("",i.crudAction," Servicios/Im\xe1gen"),l.zb(2),l.dc("formGroup",i.servicePicturesForm),l.zb(3),l.dc("ngForOf",i.categoriaDeServicio),l.zb(2),l.dc("ngForOf",i.imageToShow),l.zb(1),l.dc("ngIf","Crear"===i.crudAction)("ngIfElse",e)}}const T=[{path:"",component:(()=>{class e{constructor(e,i,t,r){this.httpSrv=e,this.adminPanelCrudService=i,this.fb=t,this.activatedRoute=r,this.someClass=!0,this.encabezadosTabla=[],this.tableData=[],this.isCreating=!1,this.isEditing=!1,this.crudAction="",this.categoriaDeServicio=[],this.creationImageError="",this.imageToShow=["../../../../../assets/no-image.png"],this.fileToUpload=[],this.acceptedFileTypes=!0,this.pictureCounter=0,this.pictures=[],this.destroy$=new s.a,this.createForm()}createForm(){this.servicePicturesForm=this.fb.group({serviceId:[null,a.m.required],image:[""]})}showSelectedImage(e){var i,t,r,c;return t=this,void 0,c=function*(){if("Crear"===this.crudAction&&!this.servicePicturesForm.controls.image.value)return void(this.creationImageError="La im\xe1gen es obligatoria");this.creationImageError="";let t=Array.from(null===(i=e.target)||void 0===i?void 0:i.files);t=yield this.checkAmountOfFiles(t),this.acceptedFileTypes=yield this.checkFilesType(t),t.length&&this.acceptedFileTypes?(this.imageToShow=[],this.fileToUpload=t,this.fileToUpload.forEach(e=>{const i=new FileReader;i.readAsDataURL(e),i.onload=()=>this.imageToShow.push(i.result)})):t.length&&!this.acceptedFileTypes||(this.imageToShow=["../../../../../assets/no-image.png"])},new((r=void 0)||(r=Promise))(function(i,s){function n(i){try{o(c.next(i))}catch(e){s(e)}}function a(i){try{o(c.throw(i))}catch(e){s(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(n,a)}o((c=c.apply(t,[])).next())})}checkAmountOfFiles(e){return new Promise(i=>{e.length>10&&(Object(d.b)("Atenci\xf3n","No se pueden subir m\xe1s de 10 im\xe1genes","OK","info"),e=e.slice(0,10)),i(e)})}checkFilesType(e){return new Promise(i=>{let t="valido";e.forEach(e=>{e.type.includes("image/jpg")||e.type.includes("image/jpeg")||e.type.includes("image/png")||(t=!1)}),i("valido"===t)})}openInput(){this.imageInput.nativeElement.click()}ngOnInit(){this.getServicios()}formSubmit(){var e;if("Crear"!==this.crudAction||this.servicePicturesForm.controls.image.value){if(this.creationImageError="",this.servicePicturesForm.markAllAsTouched(),this.servicePicturesForm.valid){const i=new FormData;i.append("serviceId",this.servicePicturesForm.controls.serviceId.value),null===(e=this.fileToUpload)||void 0===e||e.forEach(e=>{i.append("pictures",e)}),"Crear"===this.crudAction?this.crearPicturesEnLaDb(i):this.editarPicturesEnLaDb(i)}}else this.creationImageError="La im\xe1gen es obligatoria"}getServicios(){this.httpSrv.getAllServices().pipe(Object(n.a)(this.destroy$)).subscribe(e=>{for(const i of e.data)this.categoriaDeServicio.push(i),this.httpSrv.getOneService(i.id.toString()).pipe(Object(n.a)(this.destroy$)).subscribe(i=>{i.meta.status.toString().includes("20")?this.setTableData(i,e.data.length):Object(d.e)(i)},e=>Object(d.d)(e))})}setTableData(e,i){this.activatedRoute.params.pipe(Object(n.a)(this.destroy$)).subscribe({next:t=>{var r,c,s;this.pictureCounter++,this.categoriaDeServicio=this.categoriaDeServicio.filter(e=>e.id===+t.servicioId),null===(r=this.servicePicturesForm.controls.serviceId)||void 0===r||r.setValue(this.categoriaDeServicio[0].id),this.pictures.length||(this.pictures=null===(c=null==e?void 0:e.data)||void 0===c?void 0:c.Pictures.filter(e=>e.services_b_id===+t.servicioId)),this.pictureCounter===i&&(null===(s=this.pictures)||void 0===s||s.forEach(e=>{this.tableData.push({imagen:`${u.a.API_IMAGE_URL}/${e.picture}`,id:e.id})}))},error:e=>Object(d.d)(e)})}recargarServicePictures(e){e&&(this.resetsetControls(),this.tableData=[],this.pictureCounter=0,this.categoriaDeServicio=[],this.pictures=[],this.isCreating=!1,this.isEditing=!1,this.getServicios())}resetsetControls(){this.servicePicturesForm.controls.image.setValue(""),this.imageToShow=["../../../../../assets/no-image.png"],this.fileToUpload=[]}crearPictures(){this.crudAction="Crear",this.isCreating=!0,this.isEditing=!1}crearPicturesEnLaDb(e){this.adminPanelCrudService.createContentOrPictureInService(e,"pictures").pipe(Object(n.a)(this.destroy$)).subscribe(e=>{this.recargarServicePictures(!0),Object(d.a)(e,"cre\xf3","imagen de servicio")},e=>{this.recargarServicePictures(!0),Object(d.d)(e)})}editarPictures(e){var i;this.crudAction="Editar",this.isEditing=!0,this.isCreating=!1;const t=null===(i=this.pictures)||void 0===i?void 0:i.find(i=>i.id===e);t&&(this.pictureId=t.id,this.imageToShow=[`${u.a.API_IMAGE_URL}/${t.picture}`])}editarPicturesEnLaDb(e){this.adminPanelCrudService.editContentOrPictureInService(this.pictureId,e,"pictures").pipe(Object(n.a)(this.destroy$)).subscribe(e=>{this.recargarServicePictures(!0),Object(d.a)(e,"edit\xf3","imagen de servicio")},e=>{this.recargarServicePictures(!0),Object(d.d)(e)})}borrarPictures(e){b.a.fire({title:"\xbfSeguro quer\xe9s elimninar el trabajo realizado seleccionado?",showDenyButton:!0,confirmButtonText:"Si, borrar",denyButtonText:"No"}).then(i=>{i.isConfirmed&&this.borrarContenidoEnLaDb(e)})}borrarContenidoEnLaDb(e){this.adminPanelCrudService.deleteContentOrImageFromService(e,"pictures").pipe(Object(n.a)(this.destroy$)).subscribe(e=>{this.recargarServicePictures(!0),Object(d.a)(e,"borr\xf3","imagen de servicio")},e=>Object(d.d)(e))}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return e.\u0275fac=function(i){return new(i||e)(l.Kb(h.a),l.Kb(g.a),l.Kb(a.c),l.Kb(c.a))},e.\u0275cmp=l.Eb({type:e,selectors:[["app-servicios-pictures"]],viewQuery:function(e,i){if(1&e&&l.rc(p,1),2&e){let e;l.ec(e=l.Xb())&&(i.imageInput=e.first)}},hostVars:2,hostBindings:function(e,i){2&e&&l.Cb("admin-panel-container",i.someClass)},decls:3,vars:2,consts:[[1,"row"],["class","col",4,"ngIf"],[1,"col"],[1,"card"],[1,"card-body"],[3,"title","filasTabla","encabezadosTabla","totalSection","onRecargar","onCreate","onEdit","onDelete",4,"ngIf"],[3,"title","filasTabla","encabezadosTabla","totalSection","onRecargar","onCreate","onEdit","onDelete"],[1,"card-header"],[1,"primary-dark"],[1,"form","p-t-20","form-material",3,"formGroup","ngSubmit"],[1,"form-group"],[4,"ngFor","ngForOf"],[1,"row","justify-content-center"],["class","col-md-4 mb-2",3,"click",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["isEditingTemplate",""],[1,"card-footer"],["type","submit",1,"btn","btn-success","waves-effect","waves-light","m-r-10","bgc-primary-dark"],["type","button",1,"btn","btn-danger","waves-effect","waves-light","m-r-10",3,"click"],[1,"col-md-4","mb-2",3,"click"],["alt","Servicio realizado",1,"img-responsive","image-gallery",3,"src"],["type","file","formControlName","image","multiple","",3,"hidden","change"],["imageInput",""],[1,"p-2","text-center"],["class","text-danger",4,"ngIf"],[1,"text-danger"],["type","file","formControlName","image",3,"hidden","change"]],template:function(e,i){1&e&&(l.Pb(0,"div",0),l.kc(1,v,4,1,"div",1),l.kc(2,w,20,6,"div",1),l.Ob()),2&e&&(l.zb(1),l.dc("ngIf",!i.isEditing&&!i.isCreating),l.zb(1),l.dc("ngIf",i.isCreating||i.isEditing))},directives:[r.m,m.a,a.n,a.h,a.e,r.l,a.b,a.g,a.d],styles:[".image-gallery[_ngcontent-%COMP%]{height:100%}"]}),e})()}];let F=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=l.Ib({type:e}),e.\u0275inj=l.Hb({imports:[[c.f.forChild(T)],c.f]}),e})();var D=t("6eV/");let k=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=l.Ib({type:e}),e.\u0275inj=l.Hb({imports:[[r.c,F,D.a,a.k]]}),e})()}}]);