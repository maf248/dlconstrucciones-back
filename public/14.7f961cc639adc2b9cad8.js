(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{Ptbo:function(t,e,o){"use strict";o.r(e),o.d(e,"ProyectosModule",function(){return L});var r=o("ofXK"),i=o("tyNb"),n=o("XNiG"),s=o("1G5W"),c=o("PSD3"),a=o.n(c),l=o("3Pt+"),d=o("ZLyn"),b=o("fXoL"),u=o("T9Ob"),p=o("o1z6"),m=o("3T3M"),f=o("FQRV");function h(t,e){if(1&t){const t=b.Qb();b.Pb(0,"app-table",6),b.Wb("onRecargar",function(e){return b.gc(t),b.Yb(2).recargarProyectos(e)})("onCreate",function(){return b.gc(t),b.Yb(2).crearProyecto()})("onEdit",function(e){return b.gc(t),b.Yb(2).editarProyecto(e)})("onDelete",function(e){return b.gc(t),b.Yb(2).borrarProyecto(e)})("onAddPayments",function(e){return b.gc(t),b.Yb(2).addPayment(e)})("onAddAssets",function(e){return b.gc(t),b.Yb(2).addAsset(e)}),b.Ob()}if(2&t){const t=b.Yb(2);b.dc("encabezadosTabla",t.encabezadosTabla)("filasTabla",t.tableData)("totalSection",null==t.projects?null:t.projects.length)("noImage",!0)("addAssets",!0)("addPayments",!0)}}function y(t,e){if(1&t&&(b.Pb(0,"div",2),b.Pb(1,"div",3),b.Pb(2,"div",4),b.kc(3,h,1,6,"app-table",5),b.Ob(),b.Ob(),b.Ob()),2&t){const t=b.Yb();b.zb(3),b.dc("ngIf",t.projects&&t.tableData)}}function v(t,e){if(1&t&&(b.Pb(0,"option",13),b.mc(1),b.Ob()),2&t){const t=e.$implicit;b.dc("value",null==t?null:t.id),b.zb(1),b.oc(" ",(null==t?null:t.first_name)+" "+(null==t?null:t.last_name)+" / email: "+(null==t?null:t.email)," ")}}function g(t,e){1&t&&(b.Pb(0,"span",29),b.mc(1,"Este dato es requerido"),b.Ob())}function P(t,e){1&t&&(b.Pb(0,"label",30),b.mc(1,"T\xedtulo*"),b.Ob())}function O(t,e){1&t&&(b.Pb(0,"span",29),b.mc(1,"Este campo es requerido"),b.Ob())}function F(t,e){1&t&&(b.Pb(0,"span",29),b.mc(1,"Debe tener al menos 6 caracteres"),b.Ob())}function I(t,e){1&t&&(b.Pb(0,"label",31),b.mc(1,"Descripci\xf3n"),b.Ob())}function C(t,e){1&t&&(b.Pb(0,"span",29),b.mc(1,"Debe tener al menos 10 caracteres"),b.Ob())}function j(t,e){1&t&&(b.Pb(0,"label",32),b.mc(1,"Total*"),b.Ob())}function D(t,e){1&t&&(b.Pb(0,"span",29),b.mc(1,"Este campo es requerido"),b.Ob())}function A(t,e){1&t&&(b.Pb(0,"span",29),b.mc(1,"El valor debe ser mayor a 0"),b.Ob())}function E(t,e){1&t&&(b.Pb(0,"label",33),b.mc(1,"Cashflow"),b.Ob())}function T(t,e){1&t&&(b.Pb(0,"span",29),b.mc(1,"Los formatos aceptados son PDF o XLSX"),b.Ob())}function w(t,e){if(1&t){const t=b.Qb();b.Pb(0,"div",2),b.Pb(1,"div",3),b.Pb(2,"div",7),b.Pb(3,"h1",8),b.mc(4),b.Ob(),b.Ob(),b.Pb(5,"div",4),b.Pb(6,"form",9),b.Wb("ngSubmit",function(){return b.gc(t),b.Yb().formSubmit()}),b.Pb(7,"div",4),b.Pb(8,"div",0),b.Pb(9,"div",2),b.Pb(10,"div",10),b.Pb(11,"label",11),b.mc(12,"Usuario*"),b.Ob(),b.Pb(13,"select",12),b.Pb(14,"option",13),b.mc(15,"--Seleccionar un usuario--"),b.Ob(),b.kc(16,v,2,2,"option",14),b.Ob(),b.Pb(17,"div",15),b.kc(18,g,2,0,"span",16),b.Ob(),b.Ob(),b.Pb(19,"div",10),b.kc(20,P,2,0,"label",17),b.Pb(21,"div",18),b.Lb(22,"input",19),b.Pb(23,"div",15),b.kc(24,O,2,0,"span",16),b.kc(25,F,2,0,"span",16),b.Ob(),b.Ob(),b.Ob(),b.Pb(26,"div",10),b.kc(27,I,2,0,"label",20),b.Pb(28,"div",18),b.Lb(29,"textarea",21),b.Pb(30,"div",15),b.kc(31,C,2,0,"span",16),b.Ob(),b.Ob(),b.Ob(),b.Pb(32,"div",10),b.kc(33,j,2,0,"label",22),b.Pb(34,"div",18),b.Lb(35,"input",23),b.Pb(36,"div",15),b.kc(37,D,2,0,"span",16),b.kc(38,A,2,0,"span",16),b.Ob(),b.Ob(),b.Ob(),b.Pb(39,"div",10),b.kc(40,E,2,0,"label",24),b.Pb(41,"div",18),b.Pb(42,"input",25),b.Wb("change",function(e){return b.gc(t),b.Yb().validateCashflowExtension(e)}),b.Ob(),b.Pb(43,"div",15),b.kc(44,T,2,0,"span",16),b.Ob(),b.Ob(),b.Ob(),b.Ob(),b.Ob(),b.Ob(),b.Pb(45,"div",26),b.Pb(46,"button",27),b.mc(47," Confirmar "),b.Ob(),b.Pb(48,"button",28),b.Wb("click",function(){return b.gc(t),b.Yb().recargarProyectos(!0)}),b.mc(49," Volver "),b.Ob(),b.Ob(),b.Ob(),b.Ob(),b.Ob(),b.Ob()}if(2&t){const t=b.Yb();b.zb(4),b.oc("",t.crudAction," Proyecto/s"),b.zb(2),b.dc("formGroup",t.proyectForm),b.zb(8),b.dc("value",null),b.zb(2),b.dc("ngForOf",t.selectData),b.zb(2),b.dc("ngIf",(null==t.proyectForm.controls.user.errors?null:t.proyectForm.controls.user.errors.required)&&t.proyectForm.controls.user.touched),b.zb(2),b.dc("ngIf","Editar"===t.crudAction),b.zb(4),b.dc("ngIf",(null==t.proyectForm.controls.title.errors?null:t.proyectForm.controls.title.errors.required)&&t.proyectForm.controls.title.touched),b.zb(1),b.dc("ngIf",(null==t.proyectForm.controls.title.errors?null:t.proyectForm.controls.title.errors.minlength)&&t.proyectForm.controls.title.touched),b.zb(2),b.dc("ngIf","Editar"===t.crudAction),b.zb(4),b.dc("ngIf",(null==t.proyectForm.controls.description.errors?null:t.proyectForm.controls.description.errors.minlength)&&t.proyectForm.controls.description.touched),b.zb(2),b.dc("ngIf","Editar"===t.crudAction),b.zb(4),b.dc("ngIf",(null==t.proyectForm.controls.total.errors?null:t.proyectForm.controls.total.errors.required)&&t.proyectForm.controls.total.touched),b.zb(1),b.dc("ngIf",(null==t.proyectForm.controls.total.errors?null:t.proyectForm.controls.total.errors.min)&&t.proyectForm.controls.total.touched),b.zb(2),b.dc("ngIf","Editar"===t.crudAction),b.zb(4),b.dc("ngIf",!t.acceptedFileTypes)}}const S=[{path:"",component:(()=>{class t{constructor(t,e,o,r,i,s){this.adminPanelCrudService=t,this.currencyPipe=e,this.fb=o,this.router=r,this.projectService=i,this.usersService=s,this.someClass=!0,this.selectData=[],this.projects=[],this.tableData=[],this.encabezadosTabla=["Nombre del proyecto","Anotaciones","Total","Debe","Cashflow","Usuario"],this.isCreating=!1,this.isEditing=!1,this.crudAction="",this.fileToUpload=null,this.acceptedFileTypes=!0,this.destroy$=new n.a,this.createForm()}createForm(){this.proyectForm=this.fb.group({title:[void 0,[l.m.required,l.m.minLength(6)]],description:["",[l.m.minLength(10)]],total:[null,[l.m.required,l.m.min(0)]],cashflow:[void 0],user:[null,l.m.required]})}ngOnInit(){this.getProyects(),this.getSelectData()}getSelectData(){this.usersService.getAllUsers().pipe(Object(s.a)(this.destroy$)).subscribe({next:t=>{var e;null===(e=null==t?void 0:t.data)||void 0===e||e.forEach(t=>{this.selectData.push({id:t.id,email:t.email,first_name:t.first_name,last_name:t.last_name})})},error:t=>Object(d.e)(t)})}formSubmit(){var t,e,o,r,i;if(this.proyectForm.markAllAsTouched(),this.proyectForm.valid){const n=new FormData;n.append("title",null===(t=this.proyectForm.controls.title)||void 0===t?void 0:t.value),n.append("total",null===(e=this.proyectForm.controls.total)||void 0===e?void 0:e.value),n.append("user",null===(o=this.proyectForm.controls.user)||void 0===o?void 0:o.value),this.fileToUpload&&n.append("cashflow",this.fileToUpload),(null===(r=this.proyectForm.controls.description)||void 0===r?void 0:r.value)&&n.append("description",null===(i=this.proyectForm.controls.description)||void 0===i?void 0:i.value),"Crear"===this.crudAction?this.crearProyectoEnLaDb(n):this.editarProyectoEnLaDb(n)}}validateCashflowExtension(t){var e;const o=null===(e=t.target)||void 0===e?void 0:e.files[0];this.acceptedFileTypes="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===o.type||"application/pdf"===o.type,this.fileToUpload=this.acceptedFileTypes?o:null}getProyects(){this.projectService.getAllProjects().pipe(Object(s.a)(this.destroy$)).subscribe(t=>{var e;(null===(e=null==t?void 0:t.meta)||void 0===e?void 0:e.status.toString().includes("20"))?(this.projects=null==t?void 0:t.data,this.setTableData()):Object(d.e)(t)},t=>Object(d.d)(t))}setTableData(){this.projects.forEach(t=>{var e,o,r,i;return this.tableData.push({imagen:"../../../../../assets/no-image.png",id:t.id,item2:t.title||`Proyecto usuario: ${null===(e=t.Users)||void 0===e?void 0:e.first_name} ${null===(o=t.Users)||void 0===o?void 0:o.last_name}`,item3:t.description||"-",item4:t.total?this.setCurrencyFormat(t.total):"NULL",item6:null!==t.balance||void 0!==t.balance?this.setCurrencyFormat(t.balance):"NULL",item7:t.cashflow?"Si":"No",item8:`${null===(r=t.Users)||void 0===r?void 0:r.first_name} ${null===(i=t.Users)||void 0===i?void 0:i.last_name}`})})}setCurrencyFormat(t){return this.currencyPipe.transform(t,"$")}recargarProyectos(t){t&&(this.resetsetControls(),this.tableData=[],this.projects=[],this.isCreating=!1,this.isEditing=!1,this.getProyects())}resetsetControls(){var t,e,o,r;null===(t=this.proyectForm.controls.title)||void 0===t||t.setValue(""),null===(e=this.proyectForm.controls.total)||void 0===e||e.setValue(""),null===(o=this.proyectForm.controls.description)||void 0===o||o.setValue(""),null===(r=this.proyectForm.controls.user)||void 0===r||r.setValue("")}crearProyecto(){this.crudAction="Crear",this.isCreating=!0,this.isEditing=!1}crearProyectoEnLaDb(t){this.adminPanelCrudService.create(t,"projects").pipe(Object(s.a)(this.destroy$)).subscribe(t=>{this.recargarProyectos(!0),Object(d.a)(t,"cre\xf3","proyecto")},t=>{this.recargarProyectos(!0),Object(d.d)(t)})}editarProyecto(t){var e;this.crudAction="Editar",this.isEditing=!0,this.isCreating=!1;const o=this.projects.find(e=>e.id===t);o&&(this.projectID=t,this.proyectForm.controls.title.setValue(o.title),this.proyectForm.controls.title.setValue(o.description),this.proyectForm.controls.total.setValue(o.total),this.proyectForm.controls.user.setValue(null===(e=o.Users)||void 0===e?void 0:e.id))}editarProyectoEnLaDb(t){this.adminPanelCrudService.edit(this.projectID,t,"projects").pipe(Object(s.a)(this.destroy$)).subscribe(t=>{this.recargarProyectos(!0),Object(d.a)(t,"edit\xf3","proyecto")},t=>{this.recargarProyectos(!0),Object(d.d)(t)})}borrarProyecto(t){a.a.fire({title:"\xbfSeguro quer\xe9s elimninar el proyecto seleccionado?",showDenyButton:!0,confirmButtonText:"Si, borrar",denyButtonText:"No"}).then(e=>{e.isConfirmed&&this.borrarProyectoEnLaDb(t)})}borrarProyectoEnLaDb(t){this.adminPanelCrudService.delete(t,"projects").pipe(Object(s.a)(this.destroy$)).subscribe(t=>{this.recargarProyectos(!0),Object(d.a)(t,"borr\xf3","proyecto")},t=>Object(d.d)(t))}addPayment(t){this.router.navigateByUrl("/admin/proyectos/payments",{state:{id:t}})}addAsset(t){this.router.navigateByUrl("/admin/proyectos/assets",{state:{id:t}})}alertFailureOrSuccess(t){200===t||201===t?a.a.fire("\xa1Excelente!","El proyecto se elimin\xf3 correctamente","success"):a.a.fire("\xa1Lo sentimos!","No pudimos cargar la informaci\xf3n, por favor recarga la p\xe1gina","error")}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(b.Kb(u.a),b.Kb(r.d),b.Kb(l.c),b.Kb(i.c),b.Kb(p.a),b.Kb(m.a))},t.\u0275cmp=b.Eb({type:t,selectors:[["app-proyectos"]],hostVars:2,hostBindings:function(t,e){2&t&&b.Cb("admin-panel-container",e.someClass)},decls:3,vars:2,consts:[[1,"row"],["class","col",4,"ngIf"],[1,"col"],[1,"card"],[1,"card-body"],["title","Proyectos",3,"encabezadosTabla","filasTabla","totalSection","noImage","addAssets","addPayments","onRecargar","onCreate","onEdit","onDelete","onAddPayments","onAddAssets",4,"ngIf"],["title","Proyectos",3,"encabezadosTabla","filasTabla","totalSection","noImage","addAssets","addPayments","onRecargar","onCreate","onEdit","onDelete","onAddPayments","onAddAssets"],[1,"card-header"],[1,"primary-dark"],[1,"form","p-t-20","form-material",3,"formGroup","ngSubmit"],[1,"form-group"],["for","userSelectInput"],["formControlName","user","id","userSelectInput",1,"form-control","custom-select"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"p-2"],["class","text-danger",4,"ngIf"],["for","titleInput",4,"ngIf"],[1,"input-group"],["type","text","placeholder","T\xedtulo","formControlName","title","id","titleInput",1,"form-control"],["for","descriptionTextArea",4,"ngIf"],["id","descriptionTextArea","placeholder","Descripci\xf3n","formControlName","description","cols","30","rows","5",1,"form-control"],["for","totalInput",4,"ngIf"],["type","number","placeholder","Total","formControlName","total","id","totalInput",1,"form-control"],["for","cashFlowInput",4,"ngIf"],["type","file","placeholder","Cashflow","formControlName","cashflow","id","cashFlowInput",1,"form-control",3,"change"],[1,"card-footer"],["type","submit",1,"btn","btn-success","waves-effect","waves-light","m-r-10","bgc-primary-dark"],["type","button",1,"btn","btn-danger","waves-effect","waves-light","m-r-10",3,"click"],[1,"text-danger"],["for","titleInput"],["for","descriptionTextArea"],["for","totalInput"],["for","cashFlowInput"]],template:function(t,e){1&t&&(b.Pb(0,"div",0),b.kc(1,y,4,1,"div",1),b.kc(2,w,50,15,"div",1),b.Ob()),2&t&&(b.zb(1),b.dc("ngIf",!e.isEditing&&!e.isCreating),b.zb(1),b.dc("ngIf",e.isCreating||e.isEditing))},directives:[r.m,f.a,l.n,l.h,l.e,l.l,l.g,l.d,l.i,l.o,r.l,l.b,l.j],styles:[""]}),t})()}];let z=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=b.Ib({type:t}),t.\u0275inj=b.Hb({imports:[[i.f.forChild(S)],i.f]}),t})();var k=o("6eV/");let L=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=b.Ib({type:t}),t.\u0275inj=b.Hb({providers:[r.d],imports:[[r.c,z,l.k,k.a]]}),t})()}}]);