(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{CQpn:function(e,i,t){"use strict";t.r(i),t.d(i,"ServiciosPicturesModule",function(){return j});var r=t("ofXK"),c=t("tyNb"),s=t("mrSG"),n=t("XNiG"),a=t("1G5W"),o=t("3Pt+"),b=t("PSD3"),d=t.n(b),l=t("ZLyn"),u=t("AytR"),h=t("fXoL"),g=t("N+K7"),m=t("T9Ob"),p=t("FQRV");const f=["imageInput"];function v(e,i){if(1&e){const e=h.Qb();h.Pb(0,"app-table",6),h.Wb("onRecargar",function(i){return h.gc(e),h.Yb(2).recargarServicePictures(i)})("onCreate",function(){return h.gc(e),h.Yb(2).crearPictures()})("onEdit",function(i){return h.gc(e),h.Yb(2).editarPictures(i)})("onDelete",function(i){return h.gc(e),h.Yb(2).borrarPictures(i)}),h.Ob()}if(2&e){const e=h.Yb(2);h.dc("title","Im\xe1genes de un servicio")("filasTabla",e.tableData)("encabezadosTabla",e.encabezadosTabla)("totalSection",null==e.tableData?null:e.tableData.length)}}function P(e,i){if(1&e&&(h.Pb(0,"div",2),h.Pb(1,"div",3),h.Pb(2,"div",4),h.kc(3,v,1,4,"app-table",5),h.Ob(),h.Ob(),h.Ob()),2&e){const e=h.Yb();h.zb(3),h.dc("ngIf",e.tableData)}}function O(e,i){if(1&e&&(h.Pb(0,"label"),h.mc(1),h.Ob()),2&e){const e=i.$implicit;h.zb(1),h.oc("Categor\xeda de servicio: ",e.title,"")}}function S(e,i){if(1&e){const e=h.Qb();h.Pb(0,"div",19),h.Wb("click",function(){return h.gc(e),h.Yb(2).openInput()}),h.Lb(1,"img",20),h.Ob()}if(2&e){const e=i.$implicit;h.zb(1),h.dc("src",e,h.hc)}}function I(e,i){if(1&e&&(h.Pb(0,"span",25),h.mc(1),h.Ob()),2&e){const e=h.Yb(3);h.zb(1),h.nc(e.creationImageError)}}function y(e,i){1&e&&(h.Pb(0,"span",25),h.mc(1,"Los formatos aceptados son JPG, JPEG y PNG"),h.Ob())}function C(e,i){if(1&e){const e=h.Qb();h.Nb(0),h.Pb(1,"input",21,22),h.Wb("change",function(i){return h.gc(e),h.Yb(2).showSelectedImage(i)}),h.Ob(),h.Pb(3,"div",23),h.kc(4,I,2,1,"span",24),h.kc(5,y,2,0,"span",24),h.Ob(),h.Mb()}if(2&e){const e=h.Yb(2);h.zb(1),h.dc("hidden",!0),h.zb(3),h.dc("ngIf",e.creationImageError),h.zb(1),h.dc("ngIf",!e.acceptedFileTypes)}}function E(e,i){1&e&&(h.Pb(0,"span",25),h.mc(1,"Los formatos aceptados son JPG, JPEG y PNG"),h.Ob())}function T(e,i){if(1&e){const e=h.Qb();h.Pb(0,"input",26,22),h.Wb("change",function(i){return h.gc(e),h.Yb(2).showSelectedImage(i)}),h.Ob(),h.Pb(2,"div",23),h.kc(3,E,2,0,"span",24),h.Ob()}if(2&e){const e=h.Yb(2);h.dc("hidden",!0),h.zb(3),h.dc("ngIf",!e.acceptedFileTypes)}}function w(e,i){if(1&e){const e=h.Qb();h.Pb(0,"div",2),h.Pb(1,"div",3),h.Pb(2,"div",7),h.Pb(3,"h1",8),h.mc(4),h.Ob(),h.Ob(),h.Pb(5,"div",4),h.Pb(6,"form",9),h.Wb("ngSubmit",function(){return h.gc(e),h.Yb().formSubmit()}),h.Pb(7,"div",4),h.Pb(8,"div",10),h.kc(9,O,2,1,"label",11),h.Ob(),h.Pb(10,"div",12),h.kc(11,S,2,1,"div",13),h.kc(12,C,6,3,"ng-container",14),h.kc(13,T,4,2,"ng-template",null,15,h.lc),h.Ob(),h.Ob(),h.Pb(15,"div",16),h.Pb(16,"button",17),h.mc(17," Confirmar "),h.Ob(),h.Pb(18,"button",18),h.Wb("click",function(){return h.gc(e),h.Yb().recargarServicePictures(!0)}),h.mc(19," Volver "),h.Ob(),h.Ob(),h.Ob(),h.Ob(),h.Ob(),h.Ob()}if(2&e){const e=h.fc(14),i=h.Yb();h.zb(4),h.oc("",i.crudAction," Servicios/Im\xe1gen"),h.zb(2),h.dc("formGroup",i.servicePicturesForm),h.zb(3),h.dc("ngForOf",i.categoriaDeServicio),h.zb(2),h.dc("ngForOf",i.imageToShow),h.zb(1),h.dc("ngIf","Crear"===i.crudAction)("ngIfElse",e)}}const D=[{path:"",component:(()=>{class e{constructor(e,i,t,r){this.httpSrv=e,this.adminPanelCrudService=i,this.fb=t,this.activatedRoute=r,this.someClass=!0,this.encabezadosTabla=[],this.tableData=[],this.isCreating=!1,this.isEditing=!1,this.crudAction="",this.categoriaDeServicio=[],this.creationImageError="",this.imageToShow=["../../../../../assets/no-image.png"],this.fileToUpload=[],this.acceptedFileTypes=!0,this.pictureCounter=0,this.pictures=[],this.destroy$=new n.a,this.createForm()}createForm(){this.servicePicturesForm=this.fb.group({serviceId:[null,o.m.required],image:[""]})}showSelectedImage(e){var i;return Object(s.a)(this,void 0,void 0,function*(){if("Crear"===this.crudAction&&!this.servicePicturesForm.controls.image.value)return void(this.creationImageError="La im\xe1gen es obligatoria");this.creationImageError="";let t=Array.from(null===(i=e.target)||void 0===i?void 0:i.files);t=yield this.checkAmountOfFiles(t),this.acceptedFileTypes=yield this.checkFilesType(t),t.length&&this.acceptedFileTypes?(this.imageToShow=[],this.fileToUpload=t,this.fileToUpload.forEach(e=>{const i=new FileReader;i.readAsDataURL(e),i.onload=()=>this.imageToShow.push(i.result)})):(this.fileToUpload=[],this.imageToShow=["../../../../../assets/no-image.png"])})}checkAmountOfFiles(e){return new Promise(i=>{e.length>10&&(Object(l.b)("Atenci\xf3n","No se pueden subir m\xe1s de 10 im\xe1genes","OK","info"),e=e.slice(0,10)),i(e)})}checkFilesType(e){return new Promise(i=>{let t="valido";e.forEach(e=>{e.type.includes("image/jpg")||e.type.includes("image/jpeg")||e.type.includes("image/png")||(t=!1)}),i("valido"===t)})}openInput(){this.imageInput.nativeElement.click()}ngOnInit(){this.getServicios()}formSubmit(){var e,i;if("Crear"!==this.crudAction||this.servicePicturesForm.controls.image.value){if(this.creationImageError="",this.servicePicturesForm.markAllAsTouched(),this.servicePicturesForm.valid){const t=new FormData;t.append("serviceId",this.servicePicturesForm.controls.serviceId.value),(null===(e=this.fileToUpload)||void 0===e?void 0:e.length)&&(null===(i=this.fileToUpload)||void 0===i||i.forEach(e=>{t.append("pictures",e)})),"Crear"===this.crudAction?this.crearPicturesEnLaDb(t):this.editarPicturesEnLaDb(t)}}else this.creationImageError="La im\xe1gen es obligatoria"}getServicios(){this.httpSrv.getAllServices().pipe(Object(a.a)(this.destroy$)).subscribe(e=>{for(const i of e.data)this.categoriaDeServicio.push(i),this.httpSrv.getOneService(i.id.toString()).pipe(Object(a.a)(this.destroy$)).subscribe(i=>{i.meta.status.toString().includes("20")?this.setTableData(i,e.data.length):Object(l.e)(i)},e=>Object(l.d)(e))})}setTableData(e,i){this.activatedRoute.params.pipe(Object(a.a)(this.destroy$)).subscribe({next:t=>{var r,c,s;this.pictureCounter++,this.categoriaDeServicio=this.categoriaDeServicio.filter(e=>e.id===+t.servicioId),null===(r=this.servicePicturesForm.controls.serviceId)||void 0===r||r.setValue(this.categoriaDeServicio[0].id),this.pictures.length||(this.pictures=null===(c=null==e?void 0:e.data)||void 0===c?void 0:c.Pictures.filter(e=>e.services_b_id===+t.servicioId)),this.pictureCounter===i&&(null===(s=this.pictures)||void 0===s||s.forEach(e=>{this.tableData.push({imagen:`${u.a.API_IMAGE_URL}/${e.picture}`,id:e.id})}))},error:e=>Object(l.d)(e)})}recargarServicePictures(e){e&&(this.resetsetControls(),this.tableData=[],this.pictureCounter=0,this.categoriaDeServicio=[],this.pictures=[],this.isCreating=!1,this.isEditing=!1,this.getServicios())}resetsetControls(){this.servicePicturesForm.controls.image.setValue(""),this.imageToShow=["../../../../../assets/no-image.png"],this.fileToUpload=[]}crearPictures(){this.crudAction="Crear",this.isCreating=!0,this.isEditing=!1}crearPicturesEnLaDb(e){this.adminPanelCrudService.createContentOrPictureInService(e,"pictures").pipe(Object(a.a)(this.destroy$)).subscribe(e=>{this.recargarServicePictures(!0),Object(l.a)(e,"cre\xf3","imagen de servicio")},e=>{this.recargarServicePictures(!0),Object(l.d)(e)})}editarPictures(e){var i;this.crudAction="Editar",this.isEditing=!0,this.isCreating=!1;const t=null===(i=this.pictures)||void 0===i?void 0:i.find(i=>i.id===e);t&&(this.pictureId=t.id,this.imageToShow=[`${u.a.API_IMAGE_URL}/${t.picture}`])}editarPicturesEnLaDb(e){this.adminPanelCrudService.editContentOrPictureInService(this.pictureId,e,"pictures").pipe(Object(a.a)(this.destroy$)).subscribe(e=>{this.recargarServicePictures(!0),Object(l.a)(e,"edit\xf3","imagen de servicio")},e=>{this.recargarServicePictures(!0),Object(l.d)(e)})}borrarPictures(e){d.a.fire({title:"\xbfSeguro quer\xe9s elimninar el trabajo realizado seleccionado?",showDenyButton:!0,confirmButtonText:"Si, borrar",denyButtonText:"No"}).then(i=>{i.isConfirmed&&this.borrarContenidoEnLaDb(e)})}borrarContenidoEnLaDb(e){this.adminPanelCrudService.deleteContentOrImageFromService(e,"pictures").pipe(Object(a.a)(this.destroy$)).subscribe(e=>{this.recargarServicePictures(!0),Object(l.a)(e,"borr\xf3","imagen de servicio")},e=>Object(l.d)(e))}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return e.\u0275fac=function(i){return new(i||e)(h.Kb(g.a),h.Kb(m.a),h.Kb(o.c),h.Kb(c.a))},e.\u0275cmp=h.Eb({type:e,selectors:[["app-servicios-pictures"]],viewQuery:function(e,i){if(1&e&&h.rc(f,1),2&e){let e;h.ec(e=h.Xb())&&(i.imageInput=e.first)}},hostVars:2,hostBindings:function(e,i){2&e&&h.Cb("admin-panel-container",i.someClass)},decls:3,vars:2,consts:[[1,"row"],["class","col",4,"ngIf"],[1,"col"],[1,"card"],[1,"card-body"],[3,"title","filasTabla","encabezadosTabla","totalSection","onRecargar","onCreate","onEdit","onDelete",4,"ngIf"],[3,"title","filasTabla","encabezadosTabla","totalSection","onRecargar","onCreate","onEdit","onDelete"],[1,"card-header"],[1,"primary-dark"],[1,"form","p-t-20","form-material",3,"formGroup","ngSubmit"],[1,"form-group"],[4,"ngFor","ngForOf"],[1,"row","justify-content-center"],["class","col-md-4 mb-2",3,"click",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["isEditingTemplate",""],[1,"card-footer"],["type","submit",1,"btn","btn-success","waves-effect","waves-light","m-r-10","bgc-primary-dark"],["type","button",1,"btn","btn-danger","waves-effect","waves-light","m-r-10",3,"click"],[1,"col-md-4","mb-2",3,"click"],["alt","Servicio realizado",1,"img-responsive","image-gallery",3,"src"],["type","file","formControlName","image","multiple","",3,"hidden","change"],["imageInput",""],[1,"p-2","text-center"],["class","text-danger",4,"ngIf"],[1,"text-danger"],["type","file","formControlName","image",3,"hidden","change"]],template:function(e,i){1&e&&(h.Pb(0,"div",0),h.kc(1,P,4,1,"div",1),h.kc(2,w,20,6,"div",1),h.Ob()),2&e&&(h.zb(1),h.dc("ngIf",!i.isEditing&&!i.isCreating),h.zb(1),h.dc("ngIf",i.isCreating||i.isEditing))},directives:[r.m,p.a,o.n,o.h,o.e,r.l,o.b,o.g,o.d],styles:[".image-gallery[_ngcontent-%COMP%]{height:100%}"]}),e})()}];let F=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=h.Ib({type:e}),e.\u0275inj=h.Hb({imports:[[c.f.forChild(D)],c.f]}),e})();var k=t("6eV/");let j=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=h.Ib({type:e}),e.\u0275inj=h.Hb({imports:[[r.c,F,k.a,o.k]]}),e})()}}]);