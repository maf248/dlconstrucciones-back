(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{qJPh:function(e,t,s){"use strict";s.r(t),s.d(t,"ManageProyectAssetsModule",function(){return D});var i=s("ofXK"),a=s("tyNb"),n=s("mrSG"),r=s("XNiG"),o=s("1G5W"),c=s("ZLyn"),d=s("PSD3"),l=s.n(d),b=s("fXoL"),h=s("o1z6"),p=s("3Pt+"),u=s("T9Ob"),g=s("FQRV");const m=["imageInput"];function f(e,t){if(1&e){const e=b.Qb();b.Pb(0,"app-table",6),b.Wb("onRecargar",function(t){return b.gc(e),b.Yb(2).recargarAssets(t)})("onCreate",function(){return b.gc(e),b.Yb(2).crearAsset()})("onEdit",function(t){return b.gc(e),b.Yb(2).editarAssets(t)})("onDelete",function(t){return b.gc(e),b.Yb(2).borrarAsset(t)}),b.Ob()}if(2&e){const e=b.Yb(2);b.dc("encabezadosTabla",e.encabezadosTabla)("filasTabla",e.tableData)("totalSection",null==e.assets?null:e.assets.length)}}function v(e,t){if(1&e&&(b.Pb(0,"div",2),b.Pb(1,"div",3),b.Pb(2,"div",4),b.kc(3,f,1,3,"app-table",5),b.Ob(),b.Ob(),b.Ob()),2&e){const e=b.Yb();b.zb(3),b.dc("ngIf",e.assets&&e.tableData)}}function y(e,t){if(1&e&&(b.Nb(0),b.Lb(1,"img",19),b.Mb()),2&e){const e=b.Yb().$implicit;b.zb(1),b.dc("src",e.path,b.hc)}}function O(e,t){if(1&e&&(b.Pb(0,"div",20),b.Lb(1,"video",21),b.Ob()),2&e){const e=b.Yb().$implicit;b.zb(1),b.dc("src",e.path,b.hc)("autoplay",!1)("muted",!0)("loop",!0)("controls",!0)}}function P(e,t){if(1&e){const e=b.Qb();b.Pb(0,"div",17),b.Wb("click",function(){return b.gc(e),b.Yb(2).openInput()}),b.kc(1,y,2,1,"ng-container",12),b.kc(2,O,2,5,"ng-template",null,18,b.lc),b.Ob()}if(2&e){const e=t.$implicit,s=b.fc(3);b.zb(1),b.dc("ngIf",e.type.includes("image"))("ngIfElse",s)}}function A(e,t){if(1&e&&(b.Pb(0,"span",26),b.mc(1),b.Ob()),2&e){const e=b.Yb(3);b.zb(1),b.nc(e.creationImageError)}}function I(e,t){1&e&&(b.Pb(0,"span",26),b.mc(1,"Los formatos aceptados son JPG, JPEG y PNG"),b.Ob())}function E(e,t){if(1&e){const e=b.Qb();b.Nb(0),b.Pb(1,"input",22,23),b.Wb("change",function(t){return b.gc(e),b.Yb(2).showSelectedImage(t)}),b.Ob(),b.Pb(3,"div",24),b.kc(4,A,2,1,"span",25),b.kc(5,I,2,0,"span",25),b.Ob(),b.Mb()}if(2&e){const e=b.Yb(2);b.zb(1),b.dc("hidden",!0),b.zb(3),b.dc("ngIf",e.creationImageError),b.zb(1),b.dc("ngIf",!e.acceptedFileTypes)}}function T(e,t){1&e&&(b.Pb(0,"span",26),b.mc(1,"Los formatos aceptados son JPG, JPEG y PNG"),b.Ob())}function j(e,t){if(1&e){const e=b.Qb();b.Pb(0,"input",27,23),b.Wb("change",function(t){return b.gc(e),b.Yb(2).showSelectedImage(t)}),b.Ob(),b.Pb(2,"div",24),b.kc(3,T,2,0,"span",25),b.Ob()}if(2&e){const e=b.Yb(2);b.dc("hidden",!0),b.zb(3),b.dc("ngIf",!e.acceptedFileTypes)}}function w(e,t){if(1&e){const e=b.Qb();b.Pb(0,"div",2),b.Pb(1,"div",3),b.Pb(2,"div",7),b.Pb(3,"h1",8),b.mc(4),b.Ob(),b.Ob(),b.Pb(5,"div",4),b.Pb(6,"form",9),b.Wb("ngSubmit",function(){return b.gc(e),b.Yb().formSubmit()}),b.Pb(7,"div",4),b.Pb(8,"div",10),b.kc(9,P,4,2,"div",11),b.kc(10,E,6,3,"ng-container",12),b.kc(11,j,4,2,"ng-template",null,13,b.lc),b.Ob(),b.Ob(),b.Pb(13,"div",14),b.Pb(14,"button",15),b.mc(15," Confirmar "),b.Ob(),b.Pb(16,"button",16),b.Wb("click",function(){return b.gc(e),b.Yb().recargarAssets(!0)}),b.mc(17," Volver "),b.Ob(),b.Ob(),b.Ob(),b.Ob(),b.Ob(),b.Ob()}if(2&e){const e=b.fc(12),t=b.Yb();b.zb(4),b.oc("",t.crudAction," Galer\xeda"),b.zb(2),b.dc("formGroup",t.assetsForm),b.zb(3),b.dc("ngForOf",t.imageToShow),b.zb(1),b.dc("ngIf","Crear"===t.crudAction)("ngIfElse",e)}}const S=[{path:"",component:(()=>{class e{constructor(e,t,s,i){this.router=e,this.projectsService=t,this.fb=s,this.adminPanelCrudService=i,this.someClass=!0,this.assets=[],this.tableData=[],this.encabezadosTabla=[],this.isCreating=!1,this.isEditing=!1,this.crudAction="",this.imageToShow=[{path:"../../../../../assets/no-image.png",type:"image/png"}],this.fileToUpload=[],this.acceptedFileTypes=!0,this.creationImageError="",this.destroy$=new r.a,this.getprojectId(),this.projectID?this.createForm():this.router.navigateByUrl("/admin/proyectos")}getprojectId(){var e,t,s;this.projectID=null===(s=null===(t=null===(e=this.router.getCurrentNavigation())||void 0===e?void 0:e.extras)||void 0===t?void 0:t.state)||void 0===s?void 0:s.id}createForm(){this.assetsForm=this.fb.group({asset:[""]})}openInput(){this.imageInput.nativeElement.click()}showSelectedImage(e){var t,s;return Object(n.a)(this,void 0,void 0,function*(){if(!(null===(t=this.assetsForm.controls.asset)||void 0===t?void 0:t.value))return void(this.creationImageError="El archivo es obligatorio");this.creationImageError="";let i=Array.from(null===(s=e.target)||void 0===s?void 0:s.files);i=yield this.checkAmountOfFiles(i),this.acceptedFileTypes=yield this.checkFilesType(i),i.length&&this.acceptedFileTypes?(this.imageToShow=[],this.fileToUpload=i,i.forEach(e=>{const t=new FileReader;t.readAsDataURL(e),t.onload=()=>this.imageToShow.push({path:t.result,type:e.type})})):(this.imageToShow=[{path:"../../../../../assets/no-image.png",type:"image/png"}],this.fileToUpload=[])})}checkAmountOfFiles(e){let t=!1,s=10;return e.forEach(e=>{e.type.includes("video")&&(t=!0)}),t&&(s=5),new Promise(t=>{e.length>s&&(Object(c.b)("Atenci\xf3n",`No se pueden subir mas de ${s} archivos`,"OK","info"),e=e.slice(0,s)),t(e)})}checkFilesType(e){return new Promise(t=>{let s="valido";e.forEach(e=>{e.type.includes("image/jpg")||e.type.includes("image/jpeg")||e.type.includes("image/png")||e.type.includes("video/mp4")||e.type.includes("video/avi")||e.type.includes("video/mov")||e.type.includes("video/wmv")||e.type.includes("video/mkv")||(s=!1)}),t("valido"===s)})}formSubmit(){var e;if(this.assetsForm.markAllAsTouched(),null===(e=this.assetsForm.controls.asset)||void 0===e?void 0:e.value){if(this.creationImageError="",this.assetsForm.valid){const e=new FormData;this.fileToUpload.length&&(e.append("projects_id",this.projectID.toString()),this.fileToUpload.forEach(t=>{e.append("asset",t)}),"Crear"===this.crudAction?this.crearAssetEnLaDb(e):this.editarAssetEnLaDb(e))}}else this.creationImageError="El archivo es obligatorio"}ngOnInit(){this.getAssets()}getAssets(){this.projectsService.getOneProject(this.projectID).pipe(Object(o.a)(this.destroy$)).subscribe(e=>{var t,s;(null===(t=null==e?void 0:e.meta)||void 0===t?void 0:t.status.toString().includes("20"))?(this.assets=null===(s=null==e?void 0:e.data)||void 0===s?void 0:s.Assets,this.getProjectAssetsFiles()):Object(c.e)(e)},e=>Object(c.d)(e))}getProjectAssetsFiles(){for(const e of this.assets)this.projectsService.getAssetsDeUnProyecto(e.asset).pipe(Object(o.a)(this.destroy$)).subscribe({next:t=>{this.setTableData(t,e)},error:e=>Object(c.d)(e)})}setTableData(e,t){const s=new FileReader;s.readAsDataURL(e),s.onload=()=>{this.tableData.push({id:t.id,imagen:s.result,tipoDeArchivo:e.type})}}recargarAssets(e){e&&(this.resetsetControls(),this.tableData=[],this.assets=[],this.isCreating=!1,this.isEditing=!1,this.fileToUpload=[],this.imageToShow=[{path:"../../../../../assets/no-image.png",type:"image/png"}],this.getAssets())}resetsetControls(){var e;null===(e=this.assetsForm.controls.asset)||void 0===e||e.setValue("")}crearAsset(){this.crudAction="Crear",this.isCreating=!0,this.isEditing=!1}crearAssetEnLaDb(e){this.adminPanelCrudService.create(e,"assets").pipe(Object(o.a)(this.destroy$)).subscribe(e=>{this.recargarAssets(!0),Object(c.a)(e,"cre\xf3","archivo")},e=>{this.recargarAssets(!0),Object(c.d)(e)})}editarAssets(e){this.crudAction="Editar",this.isEditing=!0,this.isCreating=!1,this.assets.find(t=>t.id===e)&&(this.assetId=e)}editarAssetEnLaDb(e){this.adminPanelCrudService.edit(this.assetId,e,"assets").pipe(Object(o.a)(this.destroy$)).subscribe(e=>{this.recargarAssets(!0),Object(c.a)(e,"edit\xf3","archivo")},e=>{this.recargarAssets(!0),Object(c.d)(e)})}borrarAsset(e){l.a.fire({title:"\xbfSeguro quer\xe9s elimninar el archivo seleccionado?",showDenyButton:!0,confirmButtonText:"Si, borrar",denyButtonText:"No"}).then(t=>{t.isConfirmed&&this.borrarAssetEnLaDb(e)})}borrarAssetEnLaDb(e){this.adminPanelCrudService.delete(e,"assets").pipe(Object(o.a)(this.destroy$)).subscribe(e=>{this.recargarAssets(!0),Object(c.a)(e,"borr\xf3","archivo")},e=>{this.recargarAssets(!0),Object(c.d)(e)})}}return e.\u0275fac=function(t){return new(t||e)(b.Kb(a.c),b.Kb(h.a),b.Kb(p.c),b.Kb(u.a))},e.\u0275cmp=b.Eb({type:e,selectors:[["app-manage-proyect-assets"]],viewQuery:function(e,t){if(1&e&&b.rc(m,1),2&e){let e;b.ec(e=b.Xb())&&(t.imageInput=e.first)}},hostVars:2,hostBindings:function(e,t){2&e&&b.Cb("admin-panel-container",t.someClass)},decls:3,vars:2,consts:[[1,"row"],["class","col",4,"ngIf"],[1,"col"],[1,"card"],[1,"card-body"],["title","Galer\xeda",3,"encabezadosTabla","filasTabla","totalSection","onRecargar","onCreate","onEdit","onDelete",4,"ngIf"],["title","Galer\xeda",3,"encabezadosTabla","filasTabla","totalSection","onRecargar","onCreate","onEdit","onDelete"],[1,"card-header"],[1,"primary-dark"],[1,"form","p-t-20","form-material",3,"formGroup","ngSubmit"],[1,"row","justify-content-center"],["class","col-md-4 text-center mb-2",3,"click",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["isEditingTemplate",""],[1,"card-footer","text-center"],["type","submit",1,"btn","btn-success","waves-effect","waves-light","m-r-10","bgc-primary-dark"],["type","button",1,"btn","btn-danger","waves-effect","waves-light","m-r-10",3,"click"],[1,"col-md-4","text-center","mb-2",3,"click"],["videoTemplate",""],["alt","Proyecto",1,"img-responsive","image-gallery",3,"src"],[1,"embed-responsive","embed-responsive-21by9"],[1,"embed-responsive-item","w-100",3,"src","autoplay","muted","loop","controls"],["type","file","formControlName","asset","multiple","",3,"hidden","change"],["imageInput",""],[1,"p-2","text-center"],["class","text-danger",4,"ngIf"],[1,"text-danger"],["type","file","formControlName","asset",3,"hidden","change"]],template:function(e,t){1&e&&(b.Pb(0,"div",0),b.kc(1,v,4,1,"div",1),b.kc(2,w,18,5,"div",1),b.Ob()),2&e&&(b.zb(1),b.dc("ngIf",!t.isEditing&&!t.isCreating),b.zb(1),b.dc("ngIf",t.isCreating||t.isEditing))},directives:[i.m,g.a,p.n,p.h,p.e,i.l,p.b,p.g,p.d],styles:[""]}),e})()}];let k=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=b.Ib({type:e}),e.\u0275inj=b.Hb({imports:[[a.f.forChild(S)],a.f]}),e})();var C=s("6eV/");let D=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=b.Ib({type:e}),e.\u0275inj=b.Hb({imports:[[i.c,k,p.k,C.a]]}),e})()}}]);