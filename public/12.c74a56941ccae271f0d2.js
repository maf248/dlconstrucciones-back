(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{qJPh:function(e,t,s){"use strict";s.r(t),s.d(t,"ManageProyectAssetsModule",function(){return j});var i=s("ofXK"),a=s("tyNb"),r=s("XNiG"),o=s("1G5W"),n=s("ZLyn"),c=s("PSD3"),b=s.n(c),d=s("fXoL"),l=s("o1z6"),h=s("3Pt+"),g=s("T9Ob"),u=s("FQRV");function p(e,t){if(1&e){const e=d.Qb();d.Pb(0,"app-table",6),d.Wb("onRecargar",function(t){return d.gc(e),d.Yb(2).recargarAssets(t)})("onCreate",function(){return d.gc(e),d.Yb(2).crearAsset()})("onEdit",function(t){return d.gc(e),d.Yb(2).editarAssets(t)})("onDelete",function(t){return d.gc(e),d.Yb(2).borrarAsset(t)}),d.Ob()}if(2&e){const e=d.Yb(2);d.dc("encabezadosTabla",e.encabezadosTabla)("filasTabla",e.tableData)("totalSection",null==e.assets?null:e.assets.length)}}function m(e,t){if(1&e&&(d.Pb(0,"div",2),d.Pb(1,"div",3),d.Pb(2,"div",4),d.kc(3,p,1,3,"app-table",5),d.Ob(),d.Ob(),d.Ob()),2&e){const e=d.Yb();d.zb(3),d.dc("ngIf",e.assets&&e.tableData)}}function f(e,t){if(1&e&&(d.Pb(0,"span",20),d.mc(1),d.Ob()),2&e){const e=d.Yb(2);d.zb(1),d.nc(e.creationImageError)}}function v(e,t){1&e&&(d.Pb(0,"span",20),d.Pb(1,"p"),d.mc(2,"Formatos aceptados para im\xe1gen: JPG, JPEG y PNG"),d.Ob(),d.Pb(3,"P"),d.mc(4,"Formatos aceptados para video: MOV, AVI, MP4, WMV, MKV"),d.Ob(),d.Ob())}function y(e,t){if(1&e){const e=d.Qb();d.Pb(0,"div",2),d.Pb(1,"div",3),d.Pb(2,"div",7),d.Pb(3,"h1",8),d.mc(4),d.Ob(),d.Ob(),d.Pb(5,"div",4),d.Pb(6,"form",9),d.Wb("ngSubmit",function(){return d.gc(e),d.Yb().formSubmit()}),d.Pb(7,"div",4),d.Pb(8,"div",10),d.Pb(9,"div",11),d.Wb("click",function(){return d.gc(e),d.fc(12).click()}),d.Lb(10,"img",12),d.Pb(11,"input",13,14),d.Wb("change",function(t){return d.gc(e),d.Yb().showSelectedImage(t)}),d.Ob(),d.Pb(13,"div",15),d.kc(14,f,2,1,"span",16),d.kc(15,v,5,0,"span",16),d.Ob(),d.Ob(),d.Ob(),d.Ob(),d.Pb(16,"div",17),d.Pb(17,"button",18),d.mc(18," Confirmar "),d.Ob(),d.Pb(19,"button",19),d.Wb("click",function(){return d.gc(e),d.Yb().recargarAssets(!0)}),d.mc(20," Volver "),d.Ob(),d.Ob(),d.Ob(),d.Ob(),d.Ob(),d.Ob()}if(2&e){const e=d.Yb();d.zb(4),d.oc("",e.crudAction," Galer\xeda"),d.zb(2),d.dc("formGroup",e.assetsForm),d.zb(4),d.dc("src",e.imageToShow,d.hc),d.zb(1),d.dc("hidden",!0),d.zb(3),d.dc("ngIf",e.creationImageError),d.zb(1),d.dc("ngIf",!e.acceptedFileTypes)}}const O=[{path:"",component:(()=>{class e{constructor(e,t,s,i){this.router=e,this.projectsService=t,this.fb=s,this.adminPanelCrudService=i,this.assets=[],this.tableData=[],this.encabezadosTabla=[],this.isCreating=!1,this.isEditing=!1,this.crudAction="",this.imageToShow="../../../../../assets/no-image.png",this.acceptedFileTypes=!0,this.creationImageError="",this.destroy$=new r.a,this.getprojectId(),this.projectID?this.createForm():this.router.navigateByUrl("/admin/proyectos")}getprojectId(){var e,t,s;this.projectID=null===(s=null===(t=null===(e=this.router.getCurrentNavigation())||void 0===e?void 0:e.extras)||void 0===t?void 0:t.state)||void 0===s?void 0:s.id}createForm(){this.assetsForm=this.fb.group({asset:[""]})}showSelectedImage(e){var t,s;if(!(null===(t=this.assetsForm.controls.asset)||void 0===t?void 0:t.value))return void(this.creationImageError="El archivo es obligatorio");this.creationImageError="";const i=null===(s=e.target)||void 0===s?void 0:s.files[0];if(this.acceptedFileTypes="image/jpg"===i.type||"image/jpeg"===i.type||"image/png"===i.type||"video/mp4"===i.type||"video/avi"===i.type||"video/mov"===i.type||"video/wmv"===i.type||"video/mkv"===i.type,i&&this.acceptedFileTypes)if(this.fileToUpload=i,i.type.includes("image")){const e=new FileReader;e.readAsDataURL(i),e.onload=()=>this.imageToShow=e.result}else this.imageToShow="../../../../../assets/no-image-video.jpg";else this.imageToShow="../../../../../assets/no-image.png",this.fileToUpload=null}formSubmit(){var e;if(this.assetsForm.markAllAsTouched(),null===(e=this.assetsForm.controls.asset)||void 0===e?void 0:e.value){if(this.creationImageError="",this.assetsForm.valid){const e=new FormData;this.fileToUpload&&(e.append("asset",this.fileToUpload),e.append("projects_id",this.projectID.toString()),"Crear"===this.crudAction?this.crearAssetEnLaDb(e):this.editarAssetEnLaDb(e))}}else this.creationImageError="El archivo es obligatorio"}ngOnInit(){this.getAssets()}getAssets(){this.projectsService.getOneProject(this.projectID).pipe(Object(o.a)(this.destroy$)).subscribe(e=>{var t,s;(null===(t=null==e?void 0:e.meta)||void 0===t?void 0:t.status.toString().includes("20"))?(this.assets=null===(s=null==e?void 0:e.data)||void 0===s?void 0:s.Assets,this.getProjectAssetsFiles()):Object(n.e)(e)},e=>Object(n.d)(e))}getProjectAssetsFiles(){for(const e of this.assets)this.projectsService.getAssetsDeUnProyecto(e.asset).pipe(Object(o.a)(this.destroy$)).subscribe({next:t=>{this.setTableData(t,e)},error:e=>Object(n.d)(e)})}setTableData(e,t){const s=new FileReader;s.readAsDataURL(e),s.onload=()=>{this.tableData.push({id:t.id,imagen:s.result,tipoDeArchivo:e.type})}}recargarAssets(e){e&&(this.resetsetControls(),this.tableData=[],this.assets=[],this.isCreating=!1,this.isEditing=!1,this.fileToUpload=null,this.imageToShow="../../../../../assets/no-image.png",this.getAssets())}resetsetControls(){var e;null===(e=this.assetsForm.controls.asset)||void 0===e||e.setValue("")}crearAsset(){this.crudAction="Crear",this.isCreating=!0,this.isEditing=!1}crearAssetEnLaDb(e){this.adminPanelCrudService.create(e,"assets").pipe(Object(o.a)(this.destroy$)).subscribe(e=>{this.recargarAssets(!0),Object(n.a)(e,"cre\xf3","archivo")},e=>{this.recargarAssets(!0),Object(n.d)(e)})}editarAssets(e){this.crudAction="Editar",this.isEditing=!0,this.isCreating=!1,this.assets.find(t=>t.id===e)&&(this.assetId=e)}editarAssetEnLaDb(e){this.adminPanelCrudService.edit(this.assetId,e,"assets").pipe(Object(o.a)(this.destroy$)).subscribe(e=>{this.recargarAssets(!0),Object(n.a)(e,"edit\xf3","archivo")},e=>{this.recargarAssets(!0),Object(n.d)(e)})}borrarAsset(e){b.a.fire({title:"\xbfSeguro quer\xe9s elimninar el archivo seleccionado?",showDenyButton:!0,confirmButtonText:"Si, borrar",denyButtonText:"No"}).then(t=>{t.isConfirmed&&this.borrarAssetEnLaDb(e)})}borrarAssetEnLaDb(e){this.adminPanelCrudService.delete(e,"assets").pipe(Object(o.a)(this.destroy$)).subscribe(e=>{this.recargarAssets(!0),Object(n.a)(e,"borr\xf3","archivo")},e=>{this.recargarAssets(!0),Object(n.d)(e)})}}return e.\u0275fac=function(t){return new(t||e)(d.Kb(a.c),d.Kb(l.a),d.Kb(h.c),d.Kb(g.a))},e.\u0275cmp=d.Eb({type:e,selectors:[["app-manage-proyect-assets"]],decls:3,vars:2,consts:[[1,"row"],["class","col",4,"ngIf"],[1,"col"],[1,"card"],[1,"card-body"],["title","Galer\xeda",3,"encabezadosTabla","filasTabla","totalSection","onRecargar","onCreate","onEdit","onDelete",4,"ngIf"],["title","Galer\xeda",3,"encabezadosTabla","filasTabla","totalSection","onRecargar","onCreate","onEdit","onDelete"],[1,"card-header"],[1,"primary-dark"],[1,"form","p-t-20","form-material",3,"formGroup","ngSubmit"],[1,"row","justify-content-center"],[1,"col-8","text-center",3,"click"],["alt","Lote",1,"img-responsive","w-100",3,"src"],["type","file","formControlName","asset",3,"hidden","change"],["imageInput",""],[1,"p-2"],["class","text-danger",4,"ngIf"],[1,"card-footer","text-center"],["type","submit",1,"btn","btn-success","waves-effect","waves-light","m-r-10","bgc-primary-dark"],["type","button",1,"btn","btn-danger","waves-effect","waves-light","m-r-10",3,"click"],[1,"text-danger"]],template:function(e,t){1&e&&(d.Pb(0,"div",0),d.kc(1,m,4,1,"div",1),d.kc(2,y,21,6,"div",1),d.Ob()),2&e&&(d.zb(1),d.dc("ngIf",!t.isEditing&&!t.isCreating),d.zb(1),d.dc("ngIf",t.isCreating||t.isEditing))},directives:[i.m,u.a,h.n,h.h,h.e,h.b,h.g,h.d],styles:[""]}),e})()}];let A=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.Ib({type:e}),e.\u0275inj=d.Hb({imports:[[a.f.forChild(O)],a.f]}),e})();var P=s("6eV/");let j=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.Ib({type:e}),e.\u0275inj=d.Hb({imports:[[i.c,A,h.k,P.a]]}),e})()}}]);